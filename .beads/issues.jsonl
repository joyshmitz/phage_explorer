{"id":"phage_explorer-022","title":"Layer 1: GC Skew Replication Origin Overlay [G key]","description":"Layer 1 overlay (G key): Display cumulative GC skew sparkline with origin (minimum) and terminus (maximum) markers. O(n) scan, pure TypeScript. Reveals replication mode (theta vs rolling circle). Pedagogical value: 9/10. Priority: P0 - fundamental biology, low effort, high impact.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-06T23:10:40.281601-05:00","updated_at":"2025-12-07T00:00:32.736858-05:00","closed_at":"2025-12-07T00:00:32.736858-05:00","dependencies":[{"issue_id":"phage_explorer-022","depends_on_id":"phage_explorer-2g5","type":"blocks","created_at":"2025-12-06T23:10:40.28282-05:00","created_by":"daemon"}]}
{"id":"phage_explorer-0k6","title":"Layer 3: Temporal Evolution Replay","description":"## Temporal Evolution Replay (Layer 3 Simulation)\n\n### Concept\n\nEvolution is not a photograph — it's a **movie**. When we have multiple isolates of related phages collected over time (e.g., longitudinal coevolution studies, historical laboratory stocks), we can reconstruct **how the genome changed through time**.\n\nThis feature creates an **animated time-lapse of evolution**, showing:\n- When and where each mutation appeared\n- How **effective population size (Ne)** changed (population dynamics)\n- The **substitution rate** (molecular clock calibration)\n- Branches where lineages diverged\n\nThe key mathematical tool is the **dated phylogenetic tree** — a tree where branch lengths are calibrated to real time rather than genetic distance. Combined with ancestral sequence reconstruction, we can \"play back\" evolution.\n\n### Mathematical Foundations\n\n**Molecular Clock Hypothesis:**\n```\nSubstitutions accumulate at roughly constant rate:\n  genetic_distance ≈ μ × t × 2  (for two taxa)\nWhere:\n  μ = substitution rate (subs/site/year)\n  t = divergence time\nFor phages: μ ≈ 10⁻⁵ to 10⁻³ subs/site/year (much faster than most organisms)\n```\n\n**Root-to-tip Regression (clock test):**\n```\nFor each taxon i with sampling date tᵢ:\n  dᵢ = genetic distance from root to tip\nLinear regression: dᵢ = μ × tᵢ + c\nGood clock: R² \u003e 0.8, p \u003c 0.05\ntMRCA = -c / μ (time to most recent common ancestor)\n```\n\n**Least-Squares Dating (LSD2 algorithm):**\n```\nGiven unrooted tree T with branch lengths and tip dates {t₁...tₙ}:\nMinimize: Σᵢⱼ (dᵢⱼ - |tᵢ - tⱼ|×μ)²\nSubject to: all internal node dates \u003c descendant dates\nOutput: Dated tree with internal node dates\n```\n\n**Coalescent Skyline (Population Dynamics):**\n```\nE[waiting time for k → k-1 lineages] = Ne × 2 / (k(k-1))\nSkyline plot: Estimate Ne at each coalescent interval\nReveals population crashes (bottlenecks) and expansions\n```\n\n**Ancestral Sequence Reconstruction (Felsenstein):**\n```\nMaximum Likelihood at each internal node:\nP(node = A) = Σₓ P(left=x|node=A) × P(right=y|node=A) × P(A→x) × P(A→y)\nMarginal reconstruction: Most likely state at each position\n```\n\n### Implementation Approach\n\n**Core interfaces:**\n```typescript\ninterface DatedSequence {\n  id: string;\n  sequence: string;\n  collectionDate: Date;\n  location?: string;\n}\n\ninterface ClockAnalysis {\n  rate: number;              // subs/site/year\n  rateCI: [number, number];  // 95% CI\n  tmrca: Date;               // Time to MRCA\n  r2: number;                // Regression fit\n  clockLike: boolean;        // Is clock model appropriate?\n}\n\ninterface DatedTree {\n  tree: NewickTree;\n  nodeHeights: Map\u003cstring, number\u003e;  // Node ID -\u003e date\n  rate: number;\n}\n\ninterface AncestralReconstruction {\n  nodeSequences: Map\u003cstring, string\u003e;\n  mutations: MutationEvent[];\n  confidence: Map\u003cstring, Float32Array\u003e;\n}\n\ninterface EvolutionFrame {\n  time: number;\n  displayDate: string;\n  sequence: string;\n  mutations: { position: number; from: string; to: string }[];\n  activeBranches: string[];\n  neAtTime: number;\n  cumulativeMutations: number;\n}\n```\n\n**Animation frame generator** yields frames for smooth playback with mutations appearing at interpolated times.\n\n### TUI Visualization\n\n```\nTemporal Evolution Replay: Lambda isolates (1950-2020)\n═══════════════════════════════════════════════════════════════════════════════\n\nTime: ████████████████░░░░░░░░░░░░░░  1985-03-12\n      1950                     2020\n\nTree (branches alive highlighted):\n                ┌──● Lambda-1950 (ancestor)\n            ┌───┤\n        ┌───┤   └──○ Lambda-1962\n    ────┤   └──────────● Lambda-1985 ← YOU ARE HERE\n        └──────────────────○ Lambda-2020 (future)\n\nSequence at 1985-03-12:\nPosition:  12450  12451  12452  12453\nAncestral:   A      T      G      C\nCurrent:     A      T      C*     C    ← MUTATION! G→C (1983-08-21)\n\nMutation Timeline:\n     ╭─[G12452C]──[A3891T]──[T28103C]─────────────────────────╮\n1950 ┼──────○────────○──────────○──────────────────────────────┤ 2020\n\nEffective Population Size (Ne):\n       10⁶ ┤    ╭──────╮\n       10⁵ ┤────╯      ╰──╮                ╭──────────╮\n       10⁴ ┤               ╰────────────────╯          ╰────────\n           1950         1970         1990         2010\n\n[Space] Play/Pause  [←/→] Step  [+/-] Speed  [R] Reset  [ESC] Exit\n```\n\n### Why This Is Good\n\n1. **Time is the hidden dimension**: Most tools show genetic distance, not time. Biologists think in years.\n2. **Coevolution studies**: Phage-bacteria arms races occur over weeks to months. Animation reveals dynamics.\n3. **Outbreak forensics**: For phage therapy monitoring, knowing *when* resistance arose helps understand failures.\n4. **Educational power**: Nothing conveys \"evolution is ongoing\" like watching mutations accumulate.\n5. **Population dynamics**: Ne skyline reveals bottlenecks and expansions — demographic history of the phage.\n\n### Innovation Assessment\n\n**Novelty: HIGH** - Time-tree tools exist (BEAST, TreeTime, LSD2), but no interactive animated TUI visualization. \"Time scrubber\" interface is completely novel.\n\n**Pedagogical Value: 10/10** - Teaches molecular clocks, phylogenetic dating, coalescent theory, ancestral reconstruction, population dynamics.\n\n**Wow Factor: 10/10** - Watching mutations appear one by one as timeline advances — seeing the \"ghost\" of ancestral sequence transform into modern isolate — is genuinely mesmerizing.\n\n### Data Requirements\n- Multiple dated isolate sequences (FASTA + dates)\n- At least 5-10 isolates spanning time range\n- Good temporal signal (clock-like evolution)","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-06T23:17:53.647084-05:00","updated_at":"2025-12-06T23:43:06.550889-05:00","dependencies":[{"issue_id":"phage_explorer-0k6","depends_on_id":"phage_explorer-ojb","type":"blocks","created_at":"2025-12-06T23:17:53.649358-05:00","created_by":"daemon"}]}
{"id":"phage_explorer-0qa","title":"Layer 2: Self-Homology Dot Plot","description":"Compare genome against itself to reveal internal structure: direct repeats (parallel diagonals), inverted repeats/hairpins (perpendicular lines), tandem duplications, and palindromes. Uses k-mer indexing for efficient O(n×k + matches×w) computation. Braille-character rendering for high resolution. Essential for finding terminal repeats, att sites, regulatory palindromes. Novelty: 5/10, Pedagogical: 9/10, Cool Factor: 7/10.","notes":"## SELF-HOMOLOGY DOT PLOT (MATRIX)\n\n**Comprehensive Feature Specification from Roadmap**\n\n### Concept\nCompare a genome against itself to reveal internal structure. X-axis and Y-axis both represent the genome; dots at (x,y) indicate sequence at position x matches sequence at position y.\n\n**Pattern Interpretation**:\n- Main diagonal: Always solid (self-match)\n- Parallel diagonal lines: Direct repeats (duplicated sequences, same orientation)\n- Perpendicular lines: Inverted repeats (hairpin/stem-loop structures)\n- Short perpendicular streaks: Palindromes\n- Dense clusters: Repeat-rich regulatory regions\n- Empty regions: Unique sequences with no internal homology\n\n**Why This Matters for Phages**:\n- Terminal repeats: Many phages have DTRs for circularization\n- Attachment sites (attP/attB): Contain inverted repeats for integrases\n- Regulatory palindromes: Operator sequences for homodimer binding\n- Recombination hotspots: Repeated sequences facilitate rearrangements\n\n### Mathematical Foundations\n\n**Window-Based Matching**:\nMatch(i, j, w) = true if similarity(S[i:i+w], S[j:j+w]) \u003e= threshold\n\nCommon measures:\n- Exact: count identical positions \u003e= threshold\n- Hamming: (w - hamming_distance) / w \u003e= threshold\n- BLOSUM: substitution matrix score (for proteins)\n\nTypical: window w = 10-20 bp, threshold = 80-90% identity\n\n**Efficient Computation**:\nNaive: O(n^2 × w)\nBetter: Hash-based k-mer indexing\n1. Build hash table of all k-mers and positions\n2. All position pairs for each k-mer are potential matches\n3. Extend matches to full window\nComplexity: O(n × k) + O(matches × w)\n\n**Inverted Repeat Detection**:\nCompare position i with reverse_complement(j)\nWatson-Crick: A\u003c-\u003eT, C\u003c-\u003eG\nExample: reverse_complement(\"GAATTC\") = \"GAATTC\" (palindrome!)\n\n### Implementation\n\n**Core Interfaces**:\n```typescript\ninterface DotPlotConfig {\n  windowSize: number;      // Minimum match length\n  threshold: number;       // Minimum similarity (0-1)\n  maxDots: number;         // Limit for display\n  includeInverted: boolean; // Detect inverted repeats\n}\n\ninterface Match {\n  x: number;\n  y: number;\n  length: number;\n  inverted: boolean;\n}\n```\n\n**computeDotPlot()**: Build k-mer index, find matches, extend, detect inverted repeats via reverse complement index\n\n**reverseComplement()**: A\u003c-\u003eT, C\u003c-\u003eG, reverse string\n\n**renderDotPlotBraille()**: Convert matches to Braille character grid for 8x resolution boost\n\n### TUI Visualization\n\n```\n╭───────────────────────────────────────────────────────────────────────────╮\n│  SELF-HOMOLOGY DOT PLOT: Lambda Phage (48,502 bp)                        │\n├───────────────────────────────────────────────────────────────────────────┤\n│  Window: 15 bp | Threshold: 85% | ● Direct | ○ Inverted                  │\n│                                                                           │\n│      0kb       10kb      20kb      30kb      40kb      48kb              │\n│  0   ┌──────────────────────────────────────────────────────┐ 0          │\n│      │⣿⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀│            │\n│      │⠀⣿⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀│            │\n│ 20   │⠀⠀⠀⠀⠀⣿⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀│            │\n│      │⠀⠀⠀⠀⠀⠀⣿⣀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀│ attP site │\n│ 40   │⠀⠀⠀⠀⠀⠀⠀⠀⣿⠀⠀⠀⠀⠀⠀⠈⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀│ (inverted) │\n│ 48   │⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣿⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣀⣿⣿⠀⠀⠀⠀⠀⠀│ cos (direct) │\n│      └──────────────────────────────────────────────────────┘ 48         │\n│                                                                           │\n│  Detected: 2 inverted repeats (attP), 1 direct repeat (cos termini)      │\n│  [+/-] Zoom  [W] Window  [T] Threshold  [I] Toggle inverted  [ESC] Exit  │\n╰───────────────────────────────────────────────────────────────────────────╯\n```\n\n### Assessment\n- Novelty: 5/10 - Standard tool, but Braille TUI and phage-specific context valuable\n- Pedagogical: 9/10 - Teaches sequence comparison, repeat biology, pattern recognition\n- Cool Factor: 7/10 - Seeing genome structure in one image is powerful\n\n### Files\n- packages/tui/src/components/DotPlotView.tsx\n- packages/core/src/analysis/dot-plot.ts\n- packages/core/src/analysis/repeat-finder.ts","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-06T23:14:47.63539-05:00","updated_at":"2025-12-07T00:07:04.836264-05:00","dependencies":[{"issue_id":"phage_explorer-0qa","depends_on_id":"phage_explorer-54g","type":"blocks","created_at":"2025-12-06T23:14:47.636771-05:00","created_by":"daemon"}]}
{"id":"phage_explorer-0qu","title":"Advanced: Prophage Integration Site \u0026 Excision Risk Explorer","description":"## Prophage Integration Site \u0026 Excision Risk Explorer\n\n### Concept\n\nPredict attB hot spots, integrase class, and how stable the prophage will be; simulate excision likelihood.\n\nTemperate phages don't just lyse — they **integrate** into host chromosomes. Understanding integration requires:\n1. **attP site** on phage (attachment site phage)\n2. **attB site** on host (attachment site bacteria)\n3. **Integrase** that catalyzes recombination\n4. **Stability factors** that determine excision frequency\n\nThis feature predicts integration behavior and excision risk for therapy applications.\n\n### Mathematical Foundations\n\n**att site detection:**\n```\nattP and attB sites share a core sequence (15-30 bp) flanked by arms:\n\n     attP: P' ─────── core ─────── P\n     attB: B' ─────── core ─────── B\n\nAfter integration:\n     attL: B' ─────── core ─────── P\n     attR: P' ─────── core ─────── B\n\nDetection:\n1. Find integrase gene (tyrosine/serine recombinase)\n2. Search nearby for inverted repeats\n3. Search host for homologous core\n```\n\n**Integrase classification:**\n```\nTwo major families:\n\nTyrosine recombinases (e.g., Lambda Int):\n  - Conserved RKHRH motif\n  - Catalytic Tyr at C-terminus\n  - Often integrate at tRNA genes\n  - Excision requires Xis accessory protein\n\nSerine recombinases (e.g., PhiC31):\n  - Conserved DRXXRHRXX motif\n  - Larger recombination sites\n  - More promiscuous (less target specificity)\n  - Excision often simpler\n\nHMM profiles distinguish families with high accuracy.\n```\n\n**Integration hotspots:**\n```\nCommon integration targets in bacteria:\n\ntRNA genes (most common):\n  - attB often in 3' end of tRNA\n  - Preserves tRNA function after integration\n  - Lambda: attB in tRNA-Arg\n\ntmRNA (ssrA):\n  - Ribosome rescue factor\n  - Target for P4-like phages\n\nOther hotspots:\n  - Intergenic regions with specific sequences\n  - Repeat elements\n\nScore hotspots by:\n  - Core sequence match to attP\n  - Flanking arm compatibility\n  - Distance from essential genes\n```\n\n**Excision probability model:**\n```\nExcision rate depends on:\n\n1. Integrase/Xis expression:\n   k_exc = k_0 × [Int] × [Xis] / (K_m + [Int] × [Xis])\n\n2. Repeat symmetry:\n   Perfect att sites → higher excision\n   Mutations in att → \"locked\" prophage\n\n3. Host condition:\n   SOS response → increased excision\n   Nutrient stress → increased excision\n\nStability score:\n  S = (1 - recombination_efficiency) × (1 - expression_level) × mutation_penalty\n  \nS \u003e 0.9: Very stable (likely permanent)\nS \u003c 0.5: Unstable (frequent excision)\n```\n\n### Implementation Approach\n\n**Integrase detection and typing:**\n```typescript\ninterface IntegraseAnnotation {\n  geneId: string;\n  position: { start: number; end: number };\n  family: 'tyrosine' | 'serine' | 'unknown';\n  confidence: number;\n  catalyticResidues: { position: number; residue: string }[];\n  predictedTargets: string[];  // e.g., 'tRNA-Arg', 'tmRNA'\n}\n\nasync function detectIntegrases(\n  proteins: Protein[]\n): Promise\u003cIntegraseAnnotation[]\u003e {\n  // HMM scan against integrase profiles\n  // Classify by family\n  // Identify catalytic residues\n}\n```\n\n**att site prediction:**\n```typescript\ninterface AttSite {\n  type: 'attP' | 'attB' | 'attL' | 'attR';\n  position: number;\n  sequence: string;\n  core: string;  // Conserved core sequence\n  arms: { left: string; right: string };\n  confidence: number;\n}\n\nfunction predictAttP(\n  sequence: string,\n  integrasePosition: number\n): AttSite | null {\n  // Search region around integrase (typically within 1kb)\n  // Find inverted repeats characteristic of att sites\n  // Identify core sequence\n}\n\nfunction findAttBHotspots(\n  hostGenome: string,\n  attP: AttSite\n): { position: number; gene: string; score: number }[] {\n  // Search host for core sequence matches\n  // Prioritize tRNA, tmRNA genes\n  // Score by flanking compatibility\n}\n```\n\n**Excision risk calculation:**\n```typescript\ninterface ExcisionRisk {\n  overallRisk: 'low' | 'medium' | 'high';\n  stabilityScore: number;  // 0-1, higher = more stable\n  factors: {\n    attSymmetry: number;      // att site perfection\n    xisDependence: boolean;   // requires Xis for excision?\n    sosInducible: boolean;    // induced by DNA damage?\n    spontaneousRate: number;  // excisions per cell per generation\n  };\n  recommendations: string[];\n}\n\nfunction assessExcisionRisk(\n  integrase: IntegraseAnnotation,\n  attSites: AttSite[],\n  regulatoryElements: Gene[]\n): ExcisionRisk {\n  // Analyze att site symmetry\n  // Check for Xis gene\n  // Look for SOS boxes\n  // Compute overall stability\n}\n```\n\n### TUI Visualization\n\n```\nProphage Integration Site Explorer: Lambda (temperate)\n═══════════════════════════════════════════════════════════════════════════════\n\nINTEGRASE ANALYSIS:\n┌─────────────────────────────────────────────────────────────────────────────┐\n│ Gene: int (integrase)                                                        │\n│ Position: 27,812 - 28,993                                                   │\n│ Family: TYROSINE recombinase (Lambda Int family)                            │\n│ Confidence: ████████████████████ 0.99                                       │\n│                                                                              │\n│ Catalytic residues:                                                         │\n│   Arg-212, Lys-235, His-308, Arg-311, His-333, Tyr-342                     │\n│                                                                              │\n│ Predicted target: tRNA genes (high specificity)                             │\n└─────────────────────────────────────────────────────────────────────────────┘\n\n───────────────────────────────────────────────────────────────────────────────\n\nATTACHMENT SITES:\n\nattP (phage attachment site):\n  Position: 27,600 - 27,650\n  Core:     5'-GCTTTTTTATACTAACTTG-3' (19 bp)\n  Arms:     P' = 150 bp | P = 150 bp\n\nHost attB hotspots (E. coli K-12):\n┌───────────────┬─────────────┬───────────────────────────────────────────────┐\n│ Position      │ Gene        │ Score                                          │\n├───────────────┼─────────────┼───────────────────────────────────────────────┤\n│ 801,234       │ tRNA-Arg    │ ████████████████████ 0.98  ← Lambda uses this │\n│ 1,234,567     │ tRNA-Leu    │ ████████░░░░░░░░░░░░ 0.41  (partial match)    │\n│ 2,456,789     │ tRNA-Ser    │ ██████░░░░░░░░░░░░░░ 0.32  (weak)             │\n└───────────────┴─────────────┴───────────────────────────────────────────────┘\n\nINTEGRATION MAP (simulated):\nBefore integration:\n  Host:  ═══════════[tRNA-Arg]═══════════════════════════════\n  Phage:        ────[int]──[attP]────────────────\n\nAfter integration:\n  Host:  ═══════════[attL]──[phage genome 48kb]──[attR]═════\n                    └───────────────────────────────┘\n                         Prophage inserted\n\n───────────────────────────────────────────────────────────────────────────────\n\nEXCISION RISK ASSESSMENT:\n┌─────────────────────────────────────────────────────────────────────────────┐\n│                                                                              │\n│  STABILITY SCORE: ███████░░░ 0.72  (MODERATE STABILITY)                     │\n│                                                                              │\n│  Risk Level: MEDIUM ⚠                                                       │\n│                                                                              │\n│  Factors:                                                                    │\n│  ┌──────────────────────────────────────────────────────────────────────┐  │\n│  │ att site symmetry:   ████████████████░░░░ 0.82 (near-perfect)        │  │\n│  │ Xis dependence:      YES (requires xis for efficient excision)       │  │\n│  │ SOS inducible:       YES (RecA activates excision under UV/stress)   │  │\n│  │ Spontaneous rate:    ~10⁻⁵ per cell per generation                   │  │\n│  └──────────────────────────────────────────────────────────────────────┘  │\n│                                                                              │\n│  RECOMMENDATIONS FOR THERAPY USE:                                           │\n│  ⚠ Lambda is temperate - may establish lysogeny instead of killing        │\n│  ⚠ Stress conditions (antibiotics) may induce prophage excision           │\n│  ✓ Consider using clear mutant (cI⁻) for reliable lytic behavior          │\n│  ✓ Or use strictly lytic phage like T4/T7 instead                         │\n│                                                                              │\n└─────────────────────────────────────────────────────────────────────────────┘\n\n[S] Simulate integration   [E] Excision dynamics   [H] Change host   [ESC] Exit\n```\n\n### Why This Is Good\n\n1. **Therapy safety**: Temperate phages can lysogenize, making infection worse.\n2. **Engineering applications**: Designing stable integrations requires understanding att sites.\n3. **Evolution insight**: Why do phages target tRNA genes?\n4. **Lysogeny biology**: Core to understanding temperate phage lifestyle.\n5. **att heatmaps + excision risk in TUI are rare**: Usually requires manual analysis.\n\n### Innovation Assessment\n\n**Novelty: HIGH** - Integration site prediction exists in specialized tools, but combining with excision risk modeling and therapy recommendations is novel. TUI visualization of integration dynamics is new.\n\n**Pedagogical Value: 9/10** - Teaches site-specific recombination, integrase biology, att sites, prophage stability, lysogeny control.\n\n**Wow Factor: 8/10** - Simulated integration animation; excision risk meter; att site alignment view.\n\n### Dependencies\n- Integrase HMM profiles (tyrosine, serine families)\n- Host genome data for attB prediction\n- phage_explorer-54g (Menu Infrastructure)\n\n### Relationship to Other Beads\n- Different from phage_explorer-w71 (Prophage Excision Precision Mapper) which focuses on existing prophages in host genomes\n- This focuses on predicting integration behavior of free phages","status":"open","priority":3,"issue_type":"feature","created_at":"2025-12-06T23:52:19.165886-05:00","updated_at":"2025-12-06T23:52:19.165886-05:00","dependencies":[{"issue_id":"phage_explorer-0qu","depends_on_id":"phage_explorer-54g","type":"blocks","created_at":"2025-12-06T23:56:51.260138-05:00","created_by":"daemon"}]}
{"id":"phage_explorer-0vs","title":"Layer 2: Virion Stability Predictor","description":"Layer 2 Panel: Predict virion stability (temperature, pH, ionic strength) from capsid protein properties. Critical for therapy formulation. Empirical rules based on cysteines, charge, hydrophobicity.","status":"open","priority":3,"issue_type":"feature","created_at":"2025-12-06T23:15:45.425383-05:00","updated_at":"2025-12-06T23:23:07.347231-05:00","dependencies":[{"issue_id":"phage_explorer-0vs","depends_on_id":"phage_explorer-54g","type":"blocks","created_at":"2025-12-06T23:15:45.425932-05:00","created_by":"daemon"}]}
{"id":"phage_explorer-1eu","title":"Layer 2: Hilbert Curve Genome Atlas","description":"Transform linear genomes into compact 2D visualizations using Hilbert space-filling curves that preserve locality (adjacent sequence positions stay adjacent in 2D). Order-8 curve fits 65kb in 256x256 grid. Features GC content coloring, gene density overlay, multi-genome comparison, and interactive navigation. Reveals patterns invisible in linear views: GC islands, gene clusters, compositional discontinuities. Novelty: 8/10, Pedagogical: 8/10, Cool Factor: 9/10.","notes":"## HILBERT CURVE GENOME ATLAS\n\n**Comprehensive Feature Specification from Roadmap**\n\n### Concept\nTransforms linear genome sequences into compact 2D visualizations using a space-filling fractal curve that preserves locality. Unlike row wrapping, Hilbert curves keep nearby sequence positions near each other in 2D.\n\n**Why Hilbert Curves?**\n- Locality preservation: Adjacent bases stay adjacent in 2D\n- Compact: 65kb genome fits in 256x256 (order-8)\n- Multi-scale patterns visible at different zoom levels\n- Human visual system excels at 2D pattern detection\n\n**Applications**: GC content, gene density, repeat detection, HGT, multi-genome comparison\n\n### Mathematical Foundations\n\n**Curve Construction**: Order-n has 4^n points in 2^n x 2^n grid\n- Order 8: 65,536 points (fits most phages)\n- Order 10: 1,048,576 points (large genomes)\n\n**hilbertD2XY(n, d)**: Index to (x,y) conversion using quadrant rotation\n**hilbertXY2D(n, x, y)**: Reverse for interactive queries\n\n**Properties**: Bijective, continuous (adjacent indices differ by \u003c=1), self-similar\n\n### Implementation\n\n**Core Components**: HilbertConfig (order, colorScheme, windowSize), HilbertResult (grid: Uint8Array, width, height, metrics)\n\n**Coloring**: GC content (blue-white-red), Gene density (black-green), Custom gradients\n\n**Multi-genome**: Generate aligned Hilbert maps, highlight differences\n\n### TUI Visualization\n\nSingle genome: Order-8 map with GC coloring, cursor position, gene overlay\nComparison: Side-by-side Lambda/P22/HK97 with similarity percentages\n\n### Assessment\n- Novelty: 8/10 - Rare in genomics, TUI interactive is innovative\n- Pedagogical: 8/10 - Space-filling curves, locality, recursion\n- Cool Factor: 9/10 - Striking visual transformation\n\n### Files\n- packages/tui/src/components/HilbertView.tsx\n- packages/core/src/analysis/hilbert.ts\n- packages/core/src/analysis/hilbert-compare.ts","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-06T23:14:47.310035-05:00","updated_at":"2025-12-07T00:03:28.082009-05:00","dependencies":[{"issue_id":"phage_explorer-1eu","depends_on_id":"phage_explorer-54g","type":"blocks","created_at":"2025-12-06T23:14:47.311482-05:00","created_by":"daemon"}]}
{"id":"phage_explorer-2g5","title":"Foundation: Overlay System Architecture","description":"Create OverlayManager in Zustand state store with Overlay interface (id, render, height, position). Enables Layer 1 quick toggles (G, X, B, P, R keys) and Layer 2+ visual augmentations. Precompute data on phage selection. Max 3 simultaneous overlays. THIS IS THE CRITICAL FOUNDATION for all 31 features.","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-06T23:08:21.93375-05:00","updated_at":"2025-12-07T00:14:11.859895-05:00","closed_at":"2025-12-07T00:14:11.859895-05:00"}
{"id":"phage_explorer-441","title":"Layer 3: Packaging Motor Pressure Gauge","description":"Layer 3 Overlay: Visualize packaging pressure (60 atm!) as you scroll through genome. Force increases exponentially with fill fraction. Bending + electrostatic energy model. Physics in genomics tool = unique.","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-06T23:17:53.887447-05:00","updated_at":"2025-12-06T23:23:33.4648-05:00","dependencies":[{"issue_id":"phage_explorer-441","depends_on_id":"phage_explorer-ojb","type":"blocks","created_at":"2025-12-06T23:17:53.888443-05:00","created_by":"daemon"},{"issue_id":"phage_explorer-441","depends_on_id":"phage_explorer-2g5","type":"blocks","created_at":"2025-12-06T23:40:02.457611-05:00","created_by":"daemon"}]}
{"id":"phage_explorer-46l","title":"Layer 3: Lysogeny Decision Circuit Simulator","description":"Rebuild CI/Cro-like regulatory switch from sequence motifs and simulate bistable lysis/lysogeny decisions under varying MOI/damage. Promoter/operator/terminator scans + HMMER for CI/Cro-family. Boolean fast mode or ODE/Hill kinetics. Phase portrait visualization with attractors, parameter sliders that flip basins. Novelty: High, Pedagogical: High (bistability, Hill coefficients, feedback).","notes":"## LYSOGENY/LYSIS DECISION CIRCUIT RECONSTRUCTOR\n\n### Concept\nRebuild the CI/Cro-like regulatory switch from sequence motifs and simulate bistable decisions under varying MOI/damage.\n\n### How to Build\n- **Motifs**: Promoter/operator/terminator scans in TS; HMMER for CI/Cro-family clustering (precompute)\n- **Simulation**: Boolean fast mode in TS; ODE/Hill kinetics in Rust+WASM for smooth trajectories; parameters from motif strengths\n- **Inputs**: MOI, UV/damage, inducer; outputs: CI/Cro trajectories, final state\n- **Overlay**: Operators/promoters highlighted on genome; active elements blink during sim\n\n### Why It's Good\nExplains lytic vs lysogenic outcomes; aids design of strictly lytic derivatives.\n\n### Implementation Stack\nRust+WASM ODE core; TS UI; HMMER precompute cached in SQLite; lightweight, no GPU.\n\n### TUI Visualization\nASCII phase portrait (CI vs Cro) with attractors; sliders flip basins; promoter/operator bars animate as state flips.\n\n### Files\n- packages/core/src/simulation/lysogeny-circuit.ts\n- packages/tui/src/components/LysogenyDecisionView.tsx","status":"open","priority":0,"issue_type":"feature","created_at":"2025-12-06T23:17:07.0583-05:00","updated_at":"2025-12-07T00:14:58.051593-05:00","dependencies":[{"issue_id":"phage_explorer-46l","depends_on_id":"phage_explorer-ojb","type":"blocks","created_at":"2025-12-06T23:17:07.060887-05:00","created_by":"daemon"}]}
{"id":"phage_explorer-474","title":"Advanced: RNA Structure \u0026 Packaging Signal Explorer","description":"## RNA Structure \u0026 Packaging Signal Explorer (Advanced Feature)\n\n### Concept\n\nDNA and RNA are not just sequences — they fold into **three-dimensional structures** that control biology. For phages, RNA structure is critical in:\n\n1. **Packaging signals**: Specific stem-loops tell the terminase \"start packaging here\"\n2. **Translational control**: 5' UTR structures regulate ribosome binding\n3. **Regulatory switches**: Riboswitches and attenuators control gene expression\n4. **RNA phages**: For MS2, Qβ, etc., the entire genome IS the structure\n\nThis explorer predicts RNA secondary structure along the genome, identifies conserved structural motifs, and highlights packaging signals — revealing the hidden regulatory architecture.\n\n### Mathematical Foundations\n\n**RNA folding thermodynamics:**\n```\nRNA folds to minimize free energy ΔG:\n  ΔG = ΔH - TΔS\n\nFor structure S with base pairs B:\n  ΔG(S) = Σᵢⱼ∈B ΔG(i,j) + Σ ΔG(loops) + Σ ΔG(dangles)\n\nWhere:\n  ΔG(i,j) = stacking energy (nearest-neighbor model)\n  Loop contributions: hairpin, bulge, internal, multi-loop\n  Dangles: unpaired bases at helix ends\n```\n\n**Minimum Free Energy (MFE) algorithm (Zuker):**\n```\nDynamic programming over all possible structures:\n\nW(i,j) = minimum energy for subsequence [i,j]\n       = min( W(i,j-1),                    // j unpaired\n              min over k: W(i,k-1) + V(k,j) )  // j paired with k\n\nV(i,j) = energy of structure with (i,j) pair\n       = min( Hairpin(i,j),\n              min over p,q: V(p,q) + Internal(i,j,p,q),\n              Multi-branch )\n\nTime: O(n³), Space: O(n²)\n```\n\n**Partition function for base pair probabilities:**\n```\nZ = Σₛ exp(-ΔG(S) / RT)  // Sum over all structures\n\nP(i,j paired) = Z(i,j) / Z\n\nHigh probability = confident base pair\nLow probability = structural ambiguity (regulatory?)\n```\n\n**Covariance analysis for conserved structure:**\n```\nGiven multiple sequence alignment:\n  - Identify compensatory mutations: A-U → G-C preserves pair\n  - Score: covariance(i,j) = Σ f(Xᵢ=a, Xⱼ=b) log(f(a,b) / f(a)f(b))\n\nHigh covariance = structurally constrained (pairing preserved)\n```\n\n**Packaging signal motifs:**\n```\nKnown packaging signals:\n  Lambda cos site: 12-bp cohesive ends + flanking structure\n  T4 pac site: ~170 bp with specific stem-loops\n  Phi29: pRNA (packaging RNA) with complex pseudoknot\n\nDetection:\n  - Infernal cmsearch with covariance models (CMs)\n  - Or de novo: sliding window MFE + structural conservation\n```\n\n### Implementation Approach\n\n**ViennaRNA wrapper:**\n```typescript\ninterface RNAFoldResult {\n  sequence: string;\n  structure: string;      // Dot-bracket notation\n  mfe: number;           // kcal/mol\n  ensembleEnergy: number;\n  basePairProbs: Float32Array;  // Upper triangular matrix\n}\n\nasync function foldRNA(\n  sequence: string,\n  temperature: number = 37\n): Promise\u003cRNAFoldResult\u003e {\n  // Call ViennaRNA RNAfold -p (partition function mode)\n  // Parse dot-bracket and probability matrix\n}\n```\n\n**Sliding window analysis:**\n```typescript\ninterface StructuralWindow {\n  start: number;\n  end: number;\n  structure: string;\n  mfe: number;\n  mfePerBase: number;  // Stability normalized by length\n  gcContent: number;\n  hairpinCount: number;\n  isPackagingCandidate: boolean;\n}\n\nfunction analyzeStructuralLandscape(\n  sequence: string,\n  windowSize: number = 200,\n  step: number = 50\n): StructuralWindow[] {\n  // Fold each window, identify stable structures\n  // Flag packaging candidates (high stability + characteristic motifs)\n}\n```\n\n**Packaging signal detection:**\n```typescript\ninterface PackagingSignal {\n  type: 'cos' | 'pac' | 'pRNA' | 'unknown';\n  position: number;\n  length: number;\n  structure: string;\n  confidence: number;\n  mechanism: string;\n}\n\nasync function detectPackagingSignals(\n  sequence: string,\n  phageFamily?: string\n): Promise\u003cPackagingSignal[]\u003e {\n  // Search for known motifs (cos cohesive ends, pac sites)\n  // Run Infernal cmsearch if available\n  // De novo detection via MFE stability peaks\n}\n```\n\n**Arc diagram renderer:**\n```typescript\nfunction renderArcDiagram(\n  structure: string,  // Dot-bracket\n  width: number\n): string[] {\n  // Parse base pairs from dot-bracket\n  // Draw arcs connecting paired positions\n  // Use Braille for smooth curves\n  // Color by pair probability or loop type\n}\n```\n\n### TUI Visualization\n\n```\nRNA Structure \u0026 Packaging Signal Explorer: Lambda phage\n═══════════════════════════════════════════════════════════════════════════════\n\nStructural Landscape (MFE per window):\nPosition:    0kb        10kb       20kb       30kb       40kb       48kb\n             │          │          │          │          │          │\nMFE/base: ──▄▂▄▅▄▃▂▁▄▅██▅▄▃▂▁▂▃▄▅▆▅▄▃▂▁▂▃▅▆▇▅▄▃▂▁▂▃▄▅▄▃▂▁▄▅▆█▅▄──\n                       ↑                                      ↑\n                    cos site                              cos site\n                  (packaging)                           (packaging)\n\n───────────────────────────────────────────────────────────────────────────────\n\nSelected Region: cos site (position 48,490-48,514)\n\nSequence:  5'-GGGCGGCGACCTCGCGGGTTTTCGC-3'\nStructure:    (((((((.....)))))))......\n              ↑     ↑     ↑\n           Stem    Loop   Stem\n                  (7 bp)\n\nArc Diagram:\n             ╭───────────────╮\n             │   ╭───────╮   │\n    G G G C G G C G A C C T C G C G G G T T T T C G C\n    │ │ │ │ │ │ │     │ │ │ │ │ │ │\n    ╰─┴─┴─┴─┴─┴─╯     ╰─┴─┴─┴─┴─┴─╯\n\nMFE: -12.3 kcal/mol\nPair probabilities: █████████░ (90% confident)\n\n───────────────────────────────────────────────────────────────────────────────\n\nDetected Packaging Signals:\n┌──────────┬──────────────┬─────────────────────────────────────────────┐\n│ Position │ Type         │ Description                                  │\n├──────────┼──────────────┼─────────────────────────────────────────────┤\n│   48,490 │ cos site     │ 12-bp cohesive ends, Lambda-type packaging  │\n│      1   │ cos site     │ Complementary cohesive end (circularizes)   │\n└──────────┴──────────────┴─────────────────────────────────────────────┘\n\nOther Stable Structures:\n┌──────────┬───────────────┬──────────────┬─────────────────────────────┐\n│ Position │ MFE (kcal/mol)│ Type         │ Possible Function           │\n├──────────┼───────────────┼──────────────┼─────────────────────────────┤\n│    2,340 │ -18.4         │ Hairpin      │ Transcription terminator?   │\n│    5,120 │ -15.2         │ Stem-loop    │ Ribosome binding site       │\n│   12,890 │ -22.1         │ Complex      │ Regulatory element?         │\n│   35,678 │ -19.7         │ Pseudoknot?  │ Unknown - conserved         │\n└──────────┴───────────────┴──────────────┴─────────────────────────────┘\n\n[←/→] Navigate   [Enter] Fold region   [P] Show probabilities   [ESC] Exit\n```\n\n### Why This Is Good\n\n1. **Hidden regulatory layer**: RNA structure is invisible in sequence but controls expression. This makes it visible.\n2. **Packaging mechanism insight**: cos vs pac packaging determines genome concatemers vs headful.\n3. **RNA phage essentials**: For MS2, Qβ, the genome IS the structure. Can't understand without folding.\n4. **Engineering applications**: Designing expression constructs requires understanding UTR structure.\n5. **Comparative potential**: Conserved structures across phages reveal functional constraints.\n\n### Innovation Assessment\n\n**Novelty: MEDIUM-HIGH** - RNA folding tools exist (ViennaRNA, RNAfold), but integration with genome browser, packaging signal focus, and TUI visualization are novel.\n\n**Pedagogical Value: 9/10** - Teaches RNA thermodynamics, secondary structure prediction, packaging mechanisms, translational regulation.\n\n**Wow Factor: 8/10** - Arc diagrams showing base pairs, MFE landscape plots, and packaging signal annotations make RNA structure tangible.\n\n### Data Requirements\n- ViennaRNA package (RNAfold) - external dependency\n- Optional: Infernal + Rfam covariance models for conserved structure\n- Packaging signal HMMs/patterns for known phage families","status":"open","priority":3,"issue_type":"feature","created_at":"2025-12-06T23:21:06.03497-05:00","updated_at":"2025-12-06T23:47:10.804431-05:00","dependencies":[{"issue_id":"phage_explorer-474","depends_on_id":"phage_explorer-54g","type":"blocks","created_at":"2025-12-06T23:21:06.039512-05:00","created_by":"daemon"}]}
{"id":"phage_explorer-4ee","title":"Layer 3: Ribosome Traffic Jam Simulator","description":"Model mRNA translation as stochastic particle flow using TASEP (Totally Asymmetric Simple Exclusion Process) from statistical physics. Visualize ribosomes moving along transcripts, piling up at rare codon clusters, and creating traffic jams. Real-time animation with density sparklines, codon rate heatmaps, and bottleneck annotations. Teaches codon bias, translation dynamics, ribosome biology. Novelty: 9/10, Pedagogical: 10/10, Cool Factor: 9/10.","notes":"## RIBOSOME TRAFFIC JAM SIMULATOR\n\n**Comprehensive Feature Specification from Roadmap**\n\n### Concept\nModels mRNA translation as stochastic particle flow (TASEP - Totally Asymmetric Simple Exclusion Process), visualizing ribosome movement and pileups.\n\n**TASEP Model**:\n- Ribosomes = particles hopping forward stochastically\n- Each codon has hop rate (tRNA availability)\n- Exclusion: ribosomes cannot overlap (~10 codon footprint)\n- Entry at start codon (initiation rate alpha)\n- Exit at stop codon (termination rate beta)\n\n**Biological Insights**: Rare codon clusters cause queuing, SD spacing affects initiation, codon optimization, ribosome collisions, translation efficiency\n\n### Mathematical Foundations\n\n**Master Equation**: dni/dt = ki-1 ni-1(1-ni) - ki ni(1-ni+1)\n\n**Codon Rates**: Rate proportional to tRNA concentration x adaptation factor\nCAI = exp((1/L) sum(ln(wi)))\n\n**Steady-State Phases**:\n- Low density (alpha \u003c beta): Entry-limited\n- High density (alpha \u003e beta): Exit-limited\n- Maximal current (alpha = beta = 0.5)\n\n**Footprint**: ~28-30 nt = 9-10 codons minimum spacing\n\n### Implementation\n\n**Interfaces**: RibosomeState (position, dwellTime, id, state), TranslationSimulation (mrnaLength, ribosomes[], codonRates, density, flux, time), SimulationConfig (initiationRate, terminationRate, footprint, maxTime)\n\n**simulationTick()**: Attempt initiation, process ribosomes 3'-\u003e5', check blocking, update density\n\n**isBlocked()**: Check if ribosome ahead within footprint distance\n\n**Codon Adaptation Table**: GCT/GAA/CTG/AAA = 1.0 (fast), GCG/CTA/AGG = 0.1-0.3 (slow)\n\n### TUI Visualization\n\nLive animation: mRNA track with ribosome positions (triangles/dots), density sparkline, codon rate heatmap, traffic jam annotations, real-time stats\n\n### Assessment\n- Novelty: 9/10 - TASEP rarely shown interactively in TUI\n- Pedagogical: 10/10 - Statistical physics, codon bias, translation\n- Cool Factor: 9/10 - Watching ribosomes queue is mesmerizing\n\n### Files\n- packages/tui/src/components/RibosomeTrafficView.tsx\n- packages/core/src/analysis/translation-simulation.ts\n- packages/core/src/data/codon-tables.ts","status":"open","priority":1,"issue_type":"feature","created_at":"2025-12-06T23:17:07.375278-05:00","updated_at":"2025-12-07T00:03:29.195898-05:00","dependencies":[{"issue_id":"phage_explorer-4ee","depends_on_id":"phage_explorer-ojb","type":"blocks","created_at":"2025-12-06T23:17:07.376015-05:00","created_by":"daemon"}]}
{"id":"phage_explorer-4nt","title":"Layer 2: Information-Theoretic Sequence Anomaly Scanner","description":"Layer 2 Analysis: Full-panel KL divergence + compression analysis to detect anomalous regions. Classifies as potential HGT, repetitive, or regulatory. Discovery-oriented - finds what you weren't looking for. Extends X overlay.","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-06T23:11:46.311139-05:00","updated_at":"2025-12-06T23:22:18.436181-05:00","dependencies":[{"issue_id":"phage_explorer-4nt","depends_on_id":"phage_explorer-54g","type":"blocks","created_at":"2025-12-06T23:11:46.312542-05:00","created_by":"daemon"},{"issue_id":"phage_explorer-4nt","depends_on_id":"phage_explorer-wtf","type":"blocks","created_at":"2025-12-06T23:11:46.31378-05:00","created_by":"daemon"}]}
{"id":"phage_explorer-4pf","title":"Layer 2: Non-B DNA Structure Map (G-Quadruplexes, Z-DNA)","description":"Detect and visualize alternative DNA conformations: G-quadruplexes (G4) using G4Hunter algorithm (score \u003e 1.5 = likely G4), Z-DNA using dinucleotide propensity scores (CG = 1.0, GC = 0.4, AT = -0.1). G4s regulate promoters and affect packaging; Z-DNA triggers innate immunity via ZBP1. Genome track with structure annotations and detailed sequence view. Novelty: 8/10, Pedagogical: 8/10, Cool Factor: 7/10.","notes":"## NON-B DNA STRUCTURE MAP (G4, Z-DNA)\n\n**Comprehensive Feature Specification from Roadmap**\n\n### Concept\nDNA adopts alternative conformations beyond canonical B-form helix with profound regulatory implications.\n\n**G-Quadruplexes (G4)**:\n- Four-stranded structures from G-rich sequences\n- Four guanines form planar \"G-tetrad\" via Hoogsteen bonding\n- Tetrads stack to form remarkably stable structures\n- Found in promoters, 5' UTRs, telomeres\n- In phages: regulate gene expression, affect DNA packaging\n\n**Z-DNA**:\n- Left-handed helix (vs right-handed B-DNA)\n- Forms in alternating purine-pyrimidine (CG)n sequences\n- Recognized by Z-DNA binding proteins (ZBP1/DAI)\n- Triggers innate immune responses - important for viral detection\n- In phages: may be immune evasion targets\n\n**Other Non-B**: Cruciform (inverted repeats), H-DNA/triplex (mirror repeats), slipped structures (tandem repeats)\n\n### Mathematical Foundations\n\n**G4 Pattern**:\nClassic motif: G{3,}N{1,7}G{3,}N{1,7}G{3,}N{1,7}G{3,}\n- G{3,} = 3+ consecutive guanines (one G-run)\n- N{1,7} = 1-7 any nucleotides (loop)\n\n**G4Hunter Algorithm**:\nScore = sum(G_contribution - C_contribution) / window_size\n- G-runs contribute +1 to +4 based on length\n- C-runs contribute -1 to -4 (complementary strand G4)\n- Score \u003e 1.5: likely G4\n- Score \u003e 2.0: strong G4\n\n**Z-DNA Propensity**:\nDinucleotide Z-scores:\n  CG: +1.0 (highest Z-forming)\n  CA/TG: +0.5\n  GC: +0.4\n  AT/TA: -0.1 (disfavored)\n  AA/TT: -0.5 (strongly disfavored)\n\nP_Z = sum(Z_score per dinucleotide) / window_size\nThreshold: P_Z \u003e 0.5 suggests Z-DNA potential\n\n**G4 Free Energy**:\ndG = dG_stacking + dG_loop + dG_ion\nStacking ~-10 kcal/mol per tetrad\nK+ stabilization ~-2 kcal/mol per ion\n\n### Implementation\n\n**Core Interfaces**:\n```typescript\ninterface NonBStructure {\n  type: 'G4' | 'Z-DNA' | 'cruciform' | 'triplex';\n  start: number;\n  end: number;\n  strand: '+' | '-' | 'both';\n  score: number;\n  sequence: string;\n  loops?: number[];  // Loop lengths for G4\n}\n```\n\n**detectG4()**: Compute G4Hunter scores over sliding window, find regions above threshold, assign strand based on score sign\n\n**detectZDNA()**: Compute dinucleotide Z-scores, find regions with propensity \u003e 0.5, merge overlapping regions\n\n### TUI Visualization\n\n```\n╭───────────────────────────────────────────────────────────────────────────╮\n│  NON-B DNA STRUCTURE MAP: T7 Phage                                       │\n├───────────────────────────────────────────────────────────────────────────┤\n│  Genome Track (39,937 bp):                                                │\n│  ════════════════════════════════════════════════════════════════════════ │\n│                                                                           │\n│  G4 (+ strand):    ──────⬡──────────────────⬡─────────────⬡⬡──────────── │\n│                           ↑                  ↑             ↑↑              │\n│                        Promoter?           5' UTR       Regulatory?      │\n│                                                                           │\n│  G4 (- strand):    ────────────⬢────────────────────⬢────────────────── │\n│                               ↑                     ↑                     │\n│                            Potential             Strong                   │\n│                                                                           │\n│  Z-DNA:            ─────────────────────[ZZZ]─────────────[ZZZZ]──────── │\n│                                            ↑                ↑              │\n│                                         Moderate         Strong           │\n│                                                                           │\n│  Structure Details:                                                       │\n│  | Position  | Type   | Score | Sequence                                 │\n│  |  2,341    | G4(+)  |  2.3  | GGGTTGGGTTTGGGTTTGGG                     │\n│  |  8,492    | G4(+)  |  1.8  | GGGGACGGGACGGGACGGGG                     │\n│  | 15,221    | Z-DNA  |  0.7  | CGCGCGCGCGCG                             │\n│                                                                           │\n│  Summary: 6 G4 motifs (4 strong) | 2 Z-DNA regions                       │\n│  [G] Toggle G4  [Z] Toggle Z-DNA  [D] Details  [E] Export  [ESC] Exit    │\n╰───────────────────────────────────────────────────────────────────────────╯\n```\n\n### Assessment\n- Novelty: 8/10 - G4/Z-DNA prediction exists but rarely in genome browsers, TUI novel\n- Pedagogical: 8/10 - Teaches non-canonical DNA, regulatory biology, biophysics\n- Cool Factor: 7/10 - DNA forming weird structures beyond double helix is surprising\n\n### Files\n- packages/tui/src/components/NonBDNAView.tsx\n- packages/core/src/analysis/g4-detection.ts\n- packages/core/src/analysis/z-dna-detection.ts","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-06T23:11:46.636728-05:00","updated_at":"2025-12-07T00:07:52.683753-05:00","dependencies":[{"issue_id":"phage_explorer-4pf","depends_on_id":"phage_explorer-54g","type":"blocks","created_at":"2025-12-06T23:11:46.637573-05:00","created_by":"daemon"}]}
{"id":"phage_explorer-4ty","title":"Advanced: Phage Cocktail Compatibility Matrix","description":"## Phage Cocktail Compatibility Matrix (Advanced Feature)\n\n### Concept\n\nPhage therapy rarely uses single phages — **cocktails** of multiple phages are essential to:\n1. Cover diverse host strains\n2. Prevent resistance emergence\n3. Ensure redundant killing mechanisms\n\nBut not all phages work together. Some interfere through:\n- **Superinfection exclusion (Sie)**: One phage blocks another from entering\n- **Receptor competition**: Both need same receptor (one wins)\n- **Lysis timing conflicts**: Different burst schedules cause resource waste\n- **Immunity/Lysogeny**: Temperate phage provides immunity against related phages\n\nThis feature computes a **compatibility matrix** across all phages and solves the **optimal cocktail selection problem**: find the minimal set covering target host range with no compatibility conflicts.\n\n### Mathematical Foundations\n\n**Compatibility scoring:**\n```\nFor phages A and B, compatibility score C(A,B) ∈ [-1, +1]:\n\nPositive factors (synergy):\n  - Different receptors: +0.3\n  - Different lysis timing (early + late): +0.2\n  - Complementary host ranges: +0.3\n  - No sequence homology in immunity regions: +0.2\n\nNegative factors (interference):\n  - Same receptor: -0.4\n  - Superinfection exclusion genes detected: -0.5\n  - Similar lysis timing: -0.2\n  - Sie genes present in both: -0.3\n  - One temperate provides immunity to other: -0.8\n\nC(A,B) = Σ positive_factors - Σ negative_factors (clamped to [-1, +1])\n```\n\n**Host range coverage:**\n```\nLet H = {h₁, h₂, ..., hₘ} = target hosts\nLet P = {p₁, p₂, ..., pₙ} = candidate phages\nLet R[i,j] = 1 if phage pᵢ infects host hⱼ, else 0\n\nCoverage of subset S ⊆ P:\n  Cov(S) = { hⱼ : ∃ pᵢ ∈ S with R[i,j] = 1 }\n```\n\n**Optimal cocktail as Set Cover + Compatibility (NP-hard):**\n```\nMaximize: |Cov(S)| (hosts covered)\nSubject to:\n  |S| ≤ k (max cocktail size, typically 3-5)\n  ∀ pᵢ, pⱼ ∈ S: C(pᵢ, pⱼ) \u003e threshold (no conflicts)\n\nSolutions:\n  - Greedy: Add phage with best coverage/compatibility ratio\n  - ILP: Optimal but slower\n  - Genetic algorithm: For large phage libraries\n```\n\n**ILP formulation:**\n```\nVariables:\n  xᵢ ∈ {0,1} = 1 if phage i selected\n  yⱼ ∈ {0,1} = 1 if host j covered\n\nMaximize: Σⱼ yⱼ\nSubject to:\n  Σᵢ xᵢ ≤ k                           (cocktail size limit)\n  yⱼ ≤ Σᵢ R[i,j] × xᵢ                 (coverage constraint)\n  xᵢ + xⱼ ≤ 1 for incompatible pairs  (compatibility constraint)\n```\n\n### Implementation Approach\n\n**Feature extraction for compatibility:**\n```typescript\ninterface PhageInterferenceFeatures {\n  phageId: number;\n  receptorGenes: string[];          // e.g., ['OmpC', 'LamB']\n  sieGenes: string[];               // Superinfection exclusion\n  lysisTime: 'early' | 'middle' | 'late';\n  lifecycle: 'lytic' | 'temperate';\n  immunityRegion?: string;          // For temperate phages\n  hostRange: Set\u003cstring\u003e;           // Confirmed hosts\n}\n```\n\n**Pairwise compatibility calculation:**\n```typescript\ninterface CompatibilityScore {\n  phageA: number;\n  phageB: number;\n  score: number;  // -1 to +1\n  factors: { name: string; contribution: number; reason: string }[];\n  compatible: boolean;  // score \u003e threshold\n}\n\n// Compute receptor overlap, Sie presence, lysis timing,\n// immunity cross-reaction, host range complementarity\n```\n\n**Optimal cocktail solver (greedy):**\n```typescript\ninterface CocktailSolution {\n  phages: number[];\n  coverage: string[];  // Hosts covered\n  coveragePercent: number;\n  compatibilityScore: number;  // Average pairwise score\n  rationale: string[];\n}\n\n// While selected.length \u003c maxSize and covered.size \u003c targetHosts.length:\n//   Find best phage (compatible + max marginal coverage)\n//   Add to selection, update covered set\n```\n\n### TUI Visualization\n\n```\nPhage Cocktail Compatibility Matrix\n═══════════════════════════════════════════════════════════════════════════════\n\nCompatibility Heatmap (12 phages):\n          │ λ   T4  T7  P22 M13 Mu  Φ29 Φ6  T5  SPβ HK97 P1  │\n──────────┼─────────────────────────────────────────────────────┤\nLambda    │ ·   +0.6 +0.4 -0.3 +0.8 +0.2 +0.5 +0.7 +0.1 -0.7 +0.3 +0.4 │\nT4        │     ·    +0.5 +0.6 +0.7 +0.3 +0.4 +0.8 +0.6 +0.4 +0.5 +0.5 │\nT7        │          ·    +0.5 +0.6 +0.4 +0.8 +0.7 +0.3 +0.3 +0.4 +0.5 │\nP22       │               ·    +0.5 -0.2 +0.3 +0.6 +0.4 +0.5 -0.4 +0.3 │\n...       │                                                             │\n──────────┴─────────────────────────────────────────────────────────────┘\n\nLegend: ▓▓▓ +0.8 ▒▒▒ +0.4 ░░░ 0.0 ··· -0.4 ▫▫▫ -0.8\n\n⚠ Incompatible pairs:\n  Lambda × SPbeta (-0.7): Cross-immunity (temperate, 78% identity)\n  Lambda × P22 (-0.3): Same receptor (LamB)\n\n───────────────────────────────────────────────────────────────────────────────\n\nCOCKTAIL OPTIMIZER\n\nTarget hosts: E. coli K-12, B, C; Salmonella; P. aeruginosa (5 total)\n\n✓ RECOMMENDED COCKTAIL:\n┌─────────────────────────────────────────────────────────────────────────────┐\n│  1. T4          Covers: E. coli K-12, E. coli B        Lysis: late          │\n│  2. T7          Covers: E. coli K-12, E. coli C        Lysis: early         │\n│  3. Phi6        Covers: P. aeruginosa                  Lysis: middle        │\n│                                                                              │\n│  Coverage: 4/5 hosts (80%)  ████████░░                                      │\n│  Compatibility: +0.67       ██████▓▓░░                                      │\n│                                                                              │\n│  Missing: Salmonella (consider adding P22)                                  │\n│                                                                              │\n│  RATIONALE:                                                                  │\n│  • T4 + T7: Different lysis timing (early + late = sustained killing)       │\n│  • T4 + T7: No receptor overlap (OmpC vs various)                           │\n│  • Phi6: Unique host range (Pseudomonas-specific)                           │\n│  • All lytic: No immunity/lysogeny conflicts                                │\n└─────────────────────────────────────────────────────────────────────────────┘\n\n[+] Add constraint   [H] Change hosts   [S] Solve again   [E] Export   [ESC] Exit\n```\n\n### Why This Is Good\n\n1. **Clinical relevance**: Phage therapy design is done by expert intuition. This provides quantitative guidance.\n2. **Resistance prevention**: Cocktails are essential but bad combinations are worse than single phages.\n3. **Scalable optimization**: As phage libraries grow (thousands), manual selection becomes impossible.\n4. **Explainable recommendations**: Not just \"use these\" but \"because X covers Y, and Z adds receptor diversity.\"\n5. **Novel contribution**: No existing tool combines compatibility scoring with coverage optimization.\n\n### Innovation Assessment\n\n**Novelty: VERY HIGH** - First computational compatibility predictor for phages. First cocktail optimization solver. Novel integration of molecular interference mechanisms.\n\n**Pedagogical Value: 9/10** - Teaches Sie, receptor competition, immunity, combinatorial optimization (set cover, ILP, greedy), therapy design principles.\n\n**Wow Factor: 9/10** - Heatmap with green (compatible) and red (incompatible) is immediately intuitive. Watching algorithm select optimal cocktail with rationale feels like having an expert consultant.\n\n### Data Requirements\n- Phage interference features (receptors, Sie genes, lysis timing)\n- Host range data (which phages infect which hosts)\n- Immunity region sequences (for temperate phages)","status":"open","priority":3,"issue_type":"feature","created_at":"2025-12-06T23:20:17.845538-05:00","updated_at":"2025-12-06T23:46:06.517103-05:00","dependencies":[{"issue_id":"phage_explorer-4ty","depends_on_id":"phage_explorer-54g","type":"blocks","created_at":"2025-12-06T23:20:17.848483-05:00","created_by":"daemon"}]}
{"id":"phage_explorer-4wz","title":"Layer 2: Structural Variant Detector (Deletions, Inversions, Translocations)","description":"Layer 2 Analysis: Detect structural variants between phages - deletions, inversions, duplications, translocations. Alignment block analysis. Essential for understanding phage mosaicism and recombination.","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-06T23:13:38.363422-05:00","updated_at":"2025-12-06T23:22:40.578129-05:00","dependencies":[{"issue_id":"phage_explorer-4wz","depends_on_id":"phage_explorer-54g","type":"blocks","created_at":"2025-12-06T23:13:38.365486-05:00","created_by":"daemon"},{"issue_id":"phage_explorer-4wz","depends_on_id":"phage_explorer-2g5","type":"blocks","created_at":"2025-12-06T23:39:31.501831-05:00","created_by":"daemon"}]}
{"id":"phage_explorer-54g","title":"Foundation: Menu Infrastructure (Analysis Menu \u0026 Simulation Hub)","description":"Create reusable ModalMenu component (Ink) for Analysis Menu (A key) and Simulation Hub (Shift+S). Implement MenuItem interface with icons, shortcuts, actions. Categorized navigation with fuzzy search. ESC always exits.","status":"in_progress","priority":1,"issue_type":"epic","created_at":"2025-12-06T23:08:58.84906-05:00","updated_at":"2025-12-06T23:47:35.010274-05:00"}
{"id":"phage_explorer-5ab","title":"Layer 1: Repeat/Palindrome Markers Overlay [R key]","description":"Layer 1 overlay (R key): Display repeat and palindrome markers - inverted repeats (hairpins), direct repeats (duplications). Self-comparison via sliding window. Identifies terminators, recombination sites. Priority: P2.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-06T23:10:41.455889-05:00","updated_at":"2025-12-07T00:14:40.77071-05:00","closed_at":"2025-12-07T00:14:40.77071-05:00","dependencies":[{"issue_id":"phage_explorer-5ab","depends_on_id":"phage_explorer-2g5","type":"blocks","created_at":"2025-12-06T23:10:41.456574-05:00","created_by":"daemon"}]}
{"id":"phage_explorer-5b5","title":"Foundation: Advanced UI State Management","description":"## Advanced UI State Management\n\nZustand state structure supporting overlay/modal/simulation/command systems.\n\n### AdvancedUIState Interface\n```typescript\ninterface AdvancedUIState {\n  // Overlay system\n  activeOverlays: Set\u003cOverlayId\u003e;\n  overlayConfigs: Map\u003cOverlayId, OverlayConfig\u003e;\n\n  // Modal system\n  activeModal: ModalId | null;\n  modalHistory: ModalId[];  // For back navigation\n\n  // Simulation state\n  activeSimulation: SimulationId | null;\n  simulationState: SimState | null;\n  simulationSpeed: number;\n  simulationPaused: boolean;\n\n  // Command palette\n  commandPaletteOpen: boolean;\n  commandSearch: string;\n  commandResults: CommandMatch[];\n  selectedCommandIndex: number;\n\n  // Computed data cache\n  analysisCache: Map\u003cstring, AnalysisResult\u003e;\n}\n```\n\n### Key Principle\nPrecompute on phage selection, not on feature activation. When user selects a phage, background-compute: GC skew, complexity, bendability, promoter predictions. Makes overlays feel instant when toggled.\n\nDepends on: All 4 foundation systems (Overlay, Menu, Command Palette, Simulation)","status":"open","priority":0,"issue_type":"feature","created_at":"2025-12-06T23:35:36.359231-05:00","updated_at":"2025-12-06T23:37:50.1692-05:00","dependencies":[{"issue_id":"phage_explorer-5b5","depends_on_id":"phage_explorer-2g5","type":"blocks","created_at":"2025-12-06T23:35:36.360877-05:00","created_by":"daemon"},{"issue_id":"phage_explorer-5b5","depends_on_id":"phage_explorer-54g","type":"blocks","created_at":"2025-12-06T23:35:36.361949-05:00","created_by":"daemon"},{"issue_id":"phage_explorer-5b5","depends_on_id":"phage_explorer-8lh","type":"blocks","created_at":"2025-12-06T23:35:36.362786-05:00","created_by":"daemon"},{"issue_id":"phage_explorer-5b5","depends_on_id":"phage_explorer-ojb","type":"blocks","created_at":"2025-12-06T23:35:36.363707-05:00","created_by":"daemon"}]}
{"id":"phage_explorer-66a","title":"Layer 2: Comparative Synteny Browser","description":"Layer 2 Analysis: Multi-track visualization of gene order conservation. Ortholog clustering + synteny block detection. Reveals modular boundaries and evolutionary relationships beyond sequence similarity.","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-06T23:13:38.661192-05:00","updated_at":"2025-12-06T23:22:41.584582-05:00","dependencies":[{"issue_id":"phage_explorer-66a","depends_on_id":"phage_explorer-54g","type":"blocks","created_at":"2025-12-06T23:13:38.661967-05:00","created_by":"daemon"}]}
{"id":"phage_explorer-6sn","title":"Advanced: Recombination Hotspot Radar","description":"## Recombination Hotspot Radar (Phylogenetic Mosaic Atlas)\n\n### Concept\nPhage genomes are not trees — they're TANGLES. Rampant horizontal gene transfer means a single phage is a mosaic assembled from potentially dozens of ancestral lineages. This feature:\n1. Detects mosaic ancestry along genomes\n2. Flags recombination breakpoints with confidence scores\n3. Colors each gene by its phylogenetic origin\n4. Reveals the true chimeric nature of phage evolution\n\n### Mathematical Foundations\n\n**Per-gene phylogenetics:**\n- Multiple sequence alignment per ortholog cluster\n- Distance matrix: D[i,j] = 1 - sequence_identity(i, j)\n- Tree construction via Neighbor-Joining: O(n³)\n- Optional: ML refinement with Jukes-Cantor/GTR model\n\n**Recombination breakpoint detection (PHI test):**\n- Compute pairwise incompatibility matrix\n- I(i,j) = 1 if sites i,j violate four-gamete test\n- PHI statistic = mean(I(i,j)) for nearby site pairs\n- Significance via permutation (P \u003c 0.05 = recombination)\n\n**Gene flow quantification:**\n- Robinson-Foulds distance: gene tree vs species tree\n- Low RF = vertical inheritance (gene follows species)\n- High RF = horizontal transfer (gene has different history)\n- Transfer direction inferred from branch length asymmetry\n\n**Phylogenetic HMM for mosaic detection:**\n- States = {Donor_1, Donor_2, ..., Donor_k} (ancestral lineages)\n- Emissions = local sequence similarity to each donor\n- Transitions = low probability (encourage few switches)\n- Viterbi decoding gives most likely ancestry path\n- Posterior decoding gives per-position confidence\n\n### Implementation (Rust/WASM)\n- neighbor_joining(dist) → NewickTree\n- phi_test(alignment, window) → PhiResult with p-value\n- edit_distance_bounded() for efficient alignment\n- Forward-backward algorithm for HMM posteriors\n\n### TypeScript Orchestration\n1. Cluster orthologs across phages\n2. Build per-gene trees (parallel in WASM)\n3. Build species tree from concatenated core genes\n4. Detect recombination breakpoints\n5. Assign gene origins by comparing to species tree\n6. Infer gene flow events\n\n### TUI Visualization\n- Animated mosaic sweep: genes colored by ancestral lineage\n- Breakpoint annotations with confidence scores\n- Gene tree discordance table (RF distance per gene)\n- Sankey-style gene flow diagram (ASCII arcs)\n- Animated HMM walk showing posterior probabilities\n\n### Pedagogical Value: 10/10\nTeaches HGT (the defining feature of phage evolution), phylogenetic trees, mosaic evolution, HMMs, four-gamete test (classic population genetics).\n\n### Dependencies\n- phage_explorer-54g (Menu Infrastructure)\n- phage_explorer-wae (Latent Space for cluster definitions)","status":"open","priority":3,"issue_type":"feature","created_at":"2025-12-06T23:19:11.092247-05:00","updated_at":"2025-12-06T23:31:23.651272-05:00","dependencies":[{"issue_id":"phage_explorer-6sn","depends_on_id":"phage_explorer-54g","type":"blocks","created_at":"2025-12-06T23:19:11.093779-05:00","created_by":"daemon"}]}
{"id":"phage_explorer-7am","title":"Advanced: Burst Kinetics \u0026 Latency Inference","description":"Infer adsorption rate, latent period, and burst size from OD/plaque time-series using SIR-like infection ODE/SDE. MAP/bootstrapped fits with credible intervals. Map parameters back to holin/endolysin/antiholin loci. Live fit plot, toggle deterministic/stochastic, residuals pane. Bridges wet-lab curves to genome-linked parameters. Novelty: High, Pedagogical: High.","notes":"## BURST KINETICS \u0026 LATENCY INFERENCE FROM GROWTH CURVES\n\n### Concept\nInfer adsorption, latent period, and burst size from OD/plaque time-series and map back to holin/endolysin/antiholin loci.\n\n### How to Build\n- **Model**: Classic infection ODE/SDE (SIR-like with adsorption, latent, burst)\n- **Inference (Rust+WASM)**: MAP/bootstrapped fits using statrs + rayon; bounded parameters; supports deterministic and tau-leaping stochastic modes\n- **Data ingest**: CSV/TSV via d3-dsv or native parser; unit normalization\n- **Genome link**: Annotate lysis cassette; display inferred latency/burst alongside gene positions\n- **UI**: Live fit plot with credible bands; toggle deterministic/stochastic; residuals pane\n\n### Why It's Good\nTurns wet-lab curves into actionable genome-linked parameters; informs dosing and cocktail design.\n\n### Implementation Stack\nRust+WASM fitting; TS charts; SQLite cache of parameter posteriors; no heavy ML deps.\n\n### TUI Visualization\nAnimated fit with shaded CI; lysis genes glow proportional to burst size; slider scrubs time to show phase (adsorption/latent/lysis).\n\n### Files\n- packages/core/src/analysis/burst-kinetics.ts\n- packages/tui/src/components/GrowthCurveFitter.tsx","status":"open","priority":3,"issue_type":"feature","created_at":"2025-12-06T23:49:11.338562-05:00","updated_at":"2025-12-07T00:14:55.406438-05:00","dependencies":[{"issue_id":"phage_explorer-7am","depends_on_id":"phage_explorer-ojb","type":"blocks","created_at":"2025-12-06T23:56:50.950647-05:00","created_by":"daemon"}]}
{"id":"phage_explorer-8lh","title":"Foundation: Command Palette System","description":"Create fuzzy-search command palette (: or Ctrl+P) for instant access to any feature. CommandRegistry singleton where all features register with name, keywords, action. Power users can access any feature in 3-4 keystrokes.","status":"in_progress","priority":0,"issue_type":"epic","created_at":"2025-12-06T23:08:59.44721-05:00","updated_at":"2025-12-06T23:51:45.500489-05:00"}
{"id":"phage_explorer-92s","title":"Foundation: Progressive Disclosure \u0026 User Journey","description":"## Progressive Disclosure \u0026 User Journey\n\nStrategy for exposing features based on user expertise level.\n\n### New User Journey (First 5 minutes)\n- Only Layer 0 (12 sacred controls)\n- Help overlay shows essential controls only\n- Navigate phages, scroll sequences, toggle DNA/AA\n\n### Intermediate User (First hour)\n- Layer 0 + Layer 1 overlays\n- Discover overlays via help\n- Try diff mode, explore 3D model\n- Help now shows 'Advanced: press A for more...'\n\n### Power User\n- Full Layer 0-4 access\n- Uses command palette (: or Ctrl+P)\n- Runs simulations, does comparative analysis\n- Discovers features through exploration\n\n### Key Insight\nEvery feature reachable in ≤3 keypresses but invisible until needed.\n\nDepends on: Help System (phage_explorer-ofm), UI Design System (phage_explorer-dx3)","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-06T23:35:35.931114-05:00","updated_at":"2025-12-07T00:08:51.333537-05:00","closed_at":"2025-12-07T00:08:51.333537-05:00","dependencies":[{"issue_id":"phage_explorer-92s","depends_on_id":"phage_explorer-ofm","type":"blocks","created_at":"2025-12-06T23:39:01.879645-05:00","created_by":"daemon"},{"issue_id":"phage_explorer-92s","depends_on_id":"phage_explorer-dx3","type":"blocks","created_at":"2025-12-06T23:39:02.988977-05:00","created_by":"daemon"}]}
{"id":"phage_explorer-9jc","title":"Advanced: Cocktail Resistance Evolution Simulator","description":"## Cocktail Resistance Evolution Simulator\n\n### Concept\n\nSimulate how resistance emerges against a phage cocktail under different MOI/regimens, parameterized by genome features (receptor diversity, anti-defense, spacer proximity).\n\nSingle phages face rapid resistance emergence. Cocktails slow this, but:\n- How many phages are enough?\n- What MOI prevents resistance?\n- How do different cocktail compositions compare?\n\nThis feature runs **evolutionary simulations** parameterized by actual genomic features to predict resistance dynamics.\n\n### Mathematical Foundations\n\n**Population dynamics model:**\n```\nBacterial populations with resistance genotypes:\n\nLet N_i(t) = population of genotype i at time t\nLet r_ij = resistance of genotype i to phage j (0 = sensitive, 1 = resistant)\n\ndN_i/dt = μ × N_i × (1 - Σ N_k/K) - Σⱼ kill_rate(j, r_ij) × P_j × N_i + mutation_flux\n\nWhere:\n  μ = growth rate\n  K = carrying capacity\n  P_j = concentration of phage j\n  kill_rate(j, r_ij) = k × (1 - r_ij)  (sensitive cells killed)\n  mutation_flux = mutations creating/destroying resistance\n```\n\n**Resistance mutation model:**\n```\nMutations to resistance occur at rate μ_res per cell per generation.\n\nProbability of resistance to phage j:\n  - Receptor mutation: P_rec = μ_base × (1 / n_receptors)\n    (more receptor options = harder to lose all)\n  - CRISPR spacer acquisition: P_crispr = μ_spacer × spacer_match_score\n    (higher match = easier to acquire targeting spacer)\n  - Defense system activation: P_defense = P_existing_defense × induction_rate\n\nTotal: P_res(j) = P_rec × P_crispr × (1 - P_anti_defense)\n\nWhere P_anti_defense = probability phage j has matching counter.\n```\n\n**Multi-phage cocktail dynamics:**\n```\nFor cocktail with phages {j₁, j₂, ..., jₙ}:\n\nCell survives if resistant to ALL phages:\n  P_survive = Π P_res(jₖ)\n\nWith 2 phages: P_survive ≈ 10⁻¹⁰ (if P_res each ~10⁻⁵)\nWith 3 phages: P_survive ≈ 10⁻¹⁵\n\nBUT: Cross-resistance is common!\n  If phages share receptor: one mutation → resist both\n  Adjusted: P_survive = P_res(independent) × P_cross_resist\n```\n\n**Gillespie/tau-leaping simulation:**\n```\nStochastic simulation for accurate dynamics:\n\nEvents:\n  1. Cell division: N_i → N_i + 1  (rate μ × N_i × (1-N/K))\n  2. Cell death by phage j: N_i → N_i - 1  (rate k × P_j × N_i × (1-r_ij))\n  3. Mutation to resistance: N_i → N_i - 1, N_j → N_j + 1\n  4. Phage burst: P_j → P_j + B  (rate burst per infected cell)\n\nTau-leaping for efficiency:\n  - Approximate multiple events per time step\n  - Poisson-distributed event counts\n  - Much faster than exact Gillespie for large populations\n```\n\n**Dosing regimen optimization:**\n```\nParameters to optimize:\n  - Initial MOI (multiplicity of infection)\n  - Dosing interval\n  - Cocktail composition\n  - Sequential vs simultaneous dosing\n\nObjective: Minimize time to clearance AND resistance probability\n\nMulti-objective optimization:\n  Pareto front of {clearance_time, P_resistance}\n```\n\n### Implementation Approach\n\n**Rust/WASM simulation engine:**\n```rust\npub struct CocktailSimulator {\n    phages: Vec\u003cPhageParams\u003e,\n    bacteria: BacteriaParams,\n    resistance_model: ResistanceModel,\n    rng: Pcg64,\n}\n\npub struct PhageParams {\n    phage_id: usize,\n    adsorption_rate: f64,\n    burst_size: f64,\n    latent_period: f64,\n    receptor: String,\n    anti_defense: Vec\u003cString\u003e,\n}\n\npub struct ResistanceModel {\n    mutation_rate: f64,\n    receptor_mutation_prob: f64,\n    cross_resistance_matrix: Array2\u003cf64\u003e,  // Phage × Phage\n}\n\nimpl CocktailSimulator {\n    pub fn run_trajectory(\u0026mut self, params: SimParams) -\u003e Trajectory {\n        // Tau-leaping simulation\n        // Returns time series of populations\n    }\n    \n    pub fn run_ensemble(\u0026mut self, n_runs: usize, params: SimParams) -\u003e EnsembleResult {\n        // Run many trajectories\n        // Return statistics (mean, variance, resistance probability)\n    }\n}\n```\n\n**Genomic feature integration:**\n```typescript\ninterface PhageResistanceProfile {\n  phageId: number;\n  receptors: string[];          // From tail fiber analysis\n  antiDefenseGenes: string[];   // From arms race scanner\n  spacerMatches: number;        // From CRISPR analysis\n  lysisTime: number;            // From annotation\n  estimatedResistanceRate: number;\n}\n\nasync function buildResistanceProfile(\n  phage: PhageFull\n): Promise\u003cPhageResistanceProfile\u003e {\n  // Extract features from genome\n  // Estimate resistance rate from genomic properties\n  // Build cross-resistance predictions\n}\n\nfunction predictCrossResistance(\n  phages: PhageResistanceProfile[]\n): Float32Array {\n  // Same receptor → high cross-resistance\n  // Same host → moderate cross-resistance\n  // Different receptor + different host → low\n}\n```\n\n**Simulation orchestration:**\n```typescript\ninterface SimulationParams {\n  cocktail: number[];           // Phage IDs\n  initialBacteria: number;      // CFU\n  initialMOI: number;           // Phage per bacterium\n  dosingInterval: number;       // Hours\n  dosingCount: number;\n  simulationTime: number;       // Hours\n  nTrajectories: number;\n}\n\ninterface SimulationResult {\n  timePoints: number[];\n  bacteriaMedian: number[];\n  bacteriaCI: [number[], number[]];\n  resistanceProb: number;\n  clearanceProb: number;\n  clearanceTime: number | null;\n  trajectories: Trajectory[];  // For visualization\n}\n\nasync function runCocktailSimulation(\n  params: SimulationParams,\n  profiles: PhageResistanceProfile[]\n): Promise\u003cSimulationResult\u003e {\n  // Call Rust/WASM simulator\n  // Return aggregated results\n}\n```\n\n### TUI Visualization\n\n```\nCocktail Resistance Evolution Simulator\n═══════════════════════════════════════════════════════════════════════════════\n\nCOCKTAIL CONFIGURATION:\n┌─────────────────────────────────────────────────────────────────────────────┐\n│ Phage 1: T4        Receptor: OmpC    Anti-defense: Dam, ModA               │\n│ Phage 2: T7        Receptor: LPS     Anti-defense: Ocr                     │\n│ Phage 3: Lambda    Receptor: LamB    Anti-defense: (none)                  │\n└─────────────────────────────────────────────────────────────────────────────┘\n\nCross-resistance matrix:\n         T4    T7    Lambda\nT4       ─     0.05  0.02\nT7       0.05  ─     0.08\nLambda   0.02  0.08  ─\n\nLow cross-resistance: Different receptors ✓\n\n───────────────────────────────────────────────────────────────────────────────\n\nSIMULATION RUNNING (1000 trajectories, 48h):\n\nBacteria (CFU/mL)\n10¹⁰ ┤ ╭──────╮\n     │ │      ╰─────────────╮                    ← Single phage (T4)\n10⁸  ┤ │                    ╰───────────────────── REGROWTH (resistance)\n     │ │\n10⁶  ┤ │  ╭──────╮\n     │ │  │      ╰───────────────────────────────── Cocktail (3 phages)\n10⁴  ┤ │  │                    ╭─────╮\n     │ │  │                    │     │\n10²  ┤ │  │                    │     ╰──────────── CLEARANCE (no regrowth)\n     │ │  │                    │\n10⁰  ┼─┴──┴────────────────────┴────────────────────────────────────────\n     0    6   12   18   24   30   36   42   48 hours\n         ↑         ↑         ↑         ↑\n       Dose 1    Dose 2    Dose 3    Dose 4\n\n───────────────────────────────────────────────────────────────────────────────\n\nOUTCOMES (1000 simulations):\n\n                        Single Phage (T4)    Cocktail (T4+T7+Lambda)\n                        ─────────────────    ───────────────────────\nClearance probability:  12%                  89% ████████████████████\nResistance probability: 78%                  3%  ░░░░░░░░░░░░░░░░░░░░\nMedian clearance time:  N/A (regrowth)       32h\n\nRESISTANCE DYNAMICS:\n┌─────────────────────────────────────────────────────────────────────────────┐\n│ Single phage: Resistance emerges by hour 18 in 78% of runs                 │\n│   • Receptor mutation (OmpC loss): 65% of resistance                       │\n│   • CRISPR spacer acquisition: 13% of resistance                           │\n│                                                                              │\n│ Cocktail: Resistance rare because requires TRIPLE mutation                  │\n│   • P(resist T4) × P(resist T7) × P(resist Lambda) ≈ 10⁻¹²                 │\n│   • 3% resistance cases: Pre-existing resistant subpopulation              │\n└─────────────────────────────────────────────────────────────────────────────┘\n\n───────────────────────────────────────────────────────────────────────────────\n\nDOSING OPTIMIZATION:\n\nTesting MOI = {0.1, 1, 10, 100} × Interval = {6h, 12h, 24h}:\n\n                    Clearance    Resistance    Phage use\nMOI=1, q12h:        78%          8%            Medium      ← RECOMMENDED\nMOI=10, q24h:       85%          5%            High\nMOI=0.1, q6h:       45%          22%           Low\nMOI=100, q12h:      89%          3%            Very High\n\n[M] Adjust MOI   [I] Adjust interval   [C] Change cocktail   [R] Re-run   [ESC] Exit\n```\n\n### Why This Is Good\n\n1. **Therapy planning**: Predict resistance before treatment.\n2. **Cocktail optimization**: Which combination minimizes resistance?\n3. **Dosing guidance**: What MOI and interval work best?\n4. **Mechanistic insight**: Why does resistance emerge? (receptor vs CRISPR vs defense)\n5. **Evolutionary simulation in TUI is unusual**: Usually requires R/Python/MATLAB.\n\n### Innovation Assessment\n\n**Novelty: VERY HIGH** - Cocktail resistance simulation exists in research, but:\n- Parameterized by actual genomic features (receptors, anti-defense)\n- Interactive TUI with real-time trajectory visualization\n- Cross-resistance computed from genome similarity\n- Dosing optimization built-in\n\n**Pedagogical Value: 10/10** - Teaches stochastic processes, evolutionary dynamics, Gillespie algorithm, resistance mechanisms, therapy design.\n\n**Wow Factor: 10/10** - Live trajectories diverging; \"risk meter\" updating in real-time; side-by-side single vs cocktail comparison; dosing optimization table.\n\n### Dependencies\n- Rust/WASM for Gillespie simulation (~5MB)\n- phage_explorer-ojb (Simulation Framework)\n- phage_explorer-4ty (Cocktail Compatibility - for cross-resistance)\n- phage_explorer-be3 (Arms Race Scanner - for anti-defense features)","status":"open","priority":3,"issue_type":"feature","created_at":"2025-12-06T23:55:45.232996-05:00","updated_at":"2025-12-06T23:55:45.232996-05:00","dependencies":[{"issue_id":"phage_explorer-9jc","depends_on_id":"phage_explorer-ojb","type":"blocks","created_at":"2025-12-06T23:56:51.540252-05:00","created_by":"daemon"}]}
{"id":"phage_explorer-axn","title":"Advanced: Periodicity \u0026 Tandem Repeat Wavelet Spectrogram","description":"## Periodicity \u0026 Tandem Repeat Wavelet Spectrogram\n\n### Concept\n\nReveal tandem repeats, packaging signals, or promoter periodicities using spectral methods (CWT/FFT).\n\nDNA sequences contain **hidden periodicities**:\n- **Tandem repeats**: Variable Number Tandem Repeats (VNTRs), microsatellites\n- **Packaging signals**: Periodic motifs recognized by terminase\n- **Nucleosome positioning**: ~10.5 bp periodicity (in eukaryotes, relevant for phage therapy)\n- **Promoter spacing**: Sigma factor binding sites at regular intervals\n\nThis feature uses **wavelet analysis** to reveal these patterns at multiple scales simultaneously.\n\n### Mathematical Foundations\n\n**Sequence encoding for spectral analysis:**\n```\nConvert DNA to numerical signal:\n\nBinary indicators (4 channels):\n  A: 1 if base is A, else 0\n  C: 1 if base is C, else 0\n  G: 1 if base is G, else 0\n  T: 1 if base is T, else 0\n\nOr physico-chemical encoding:\n  Purine/Pyrimidine: A,G = 1; C,T = -1\n  Strong/Weak:       G,C = 1; A,T = -1\n  Amino/Keto:        A,C = 1; G,T = -1\n```\n\n**Continuous Wavelet Transform (CWT):**\n```\nFor signal s(t) and wavelet ψ:\n\n  W(a, b) = (1/√a) ∫ s(t) × ψ*((t-b)/a) dt\n\nWhere:\n  a = scale (related to period)\n  b = position along sequence\n  ψ = mother wavelet (e.g., Morlet)\n\nResult: 2D spectrogram showing power at each (position, period).\n```\n\n**Fast Fourier Transform (FFT):**\n```\nFor shorter sequences, FFT is faster:\n\n  F(k) = Σ s(n) × exp(-2πi × k × n / N)\n\nPower spectrum:\n  P(k) = |F(k)|²\n\nPeriod = N/k for frequency bin k.\n```\n\n**Significant period detection:**\n```\nNull hypothesis: sequence is random (no periodicity)\n\nExpected power under null:\n  E[P(k)] = σ² / N  (white noise)\n\nSignificance test:\n  Z(k) = (P(k) - E[P(k)]) / std(P_null)\n\nBonferroni correction for multiple testing.\nSignificant if Z(k) \u003e threshold after correction.\n```\n\n**Repeat family detection:**\n```\nTandem repeat structure:\n  (unit)_n where unit is repeated n times\n\nDetection via autocorrelation:\n  R(τ) = Σ s(t) × s(t+τ)\n\nPeak at τ = unit_length indicates repeat.\n\nCombine with CWT: strong power at period = unit_length.\n```\n\n### Implementation Approach\n\n**Rust/WASM wavelet transform:**\n```rust\nuse rustfft::FftPlanner;\nuse realfft::RealFftPlanner;\n\npub struct WaveletTransform {\n    scales: Vec\u003cf64\u003e,  // Periods to analyze\n    wavelet: Wavelet,  // Morlet, Mexican hat, etc.\n}\n\nimpl WaveletTransform {\n    pub fn transform(\u0026self, signal: \u0026[f64]) -\u003e Array2\u003cf64\u003e {\n        // Returns 2D spectrogram [scales × positions]\n        let mut result = Array2::zeros((self.scales.len(), signal.len()));\n        \n        for (i, \u0026scale) in self.scales.iter().enumerate() {\n            // Convolve signal with scaled wavelet\n            let wavelet = self.wavelet.at_scale(scale);\n            result.row_mut(i).assign(\u0026convolve(signal, \u0026wavelet));\n        }\n        \n        result\n    }\n}\n\npub fn detect_significant_periods(\n    spectrogram: \u0026Array2\u003cf64\u003e,\n    significance_level: f64,\n) -\u003e Vec\u003c(usize, f64, f64)\u003e {\n    // Returns (position, period, power) for significant peaks\n}\n```\n\n**TypeScript orchestration:**\n```typescript\ninterface SpectrogramResult {\n  positions: number[];\n  periods: number[];\n  power: Float32Array;  // 2D flattened\n  significantPeaks: { position: number; period: number; power: number }[];\n}\n\ninterface RepeatAnnotation {\n  start: number;\n  end: number;\n  unitLength: number;\n  copies: number;\n  unitSequence: string;\n  type: 'microsatellite' | 'minisatellite' | 'packaging' | 'promoter';\n}\n\nasync function analyzePeriodicities(\n  sequence: string,\n  encoding: 'binary' | 'purine' | 'gc',\n  minPeriod: number = 3,\n  maxPeriod: number = 500\n): Promise\u003cSpectrogramResult\u003e {\n  // Encode sequence\n  // Call Rust/WASM CWT\n  // Detect significant peaks\n}\n\nfunction annotateRepeats(\n  sequence: string,\n  peaks: SpectrogramResult['significantPeaks']\n): RepeatAnnotation[] {\n  // For each significant period peak:\n  //   Extract candidate repeat unit\n  //   Verify by direct string matching\n  //   Classify repeat type\n}\n```\n\n**Braille spectrogram renderer:**\n```typescript\nfunction renderSpectrogram(\n  result: SpectrogramResult,\n  width: number,\n  height: number\n): string[] {\n  // Map power values to Braille density\n  // High power = more dots\n  // Downsample to terminal size\n  // Add axis labels (position, period)\n}\n```\n\n### TUI Visualization\n\n```\nPeriodicity \u0026 Repeat Spectrogram: T4 phage\n═══════════════════════════════════════════════════════════════════════════════\n\nWAVELET SPECTROGRAM (power by position and period):\n\nPeriod\n(bp)   Position along genome (kb)\n  │    0    20    40    60    80   100   120   140   160\n500┤    ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░\n200┤    ░░░░░░░░░░██░░░░░░░░░░░░░░░░░░░░░░░░██░░░░░░░░░░░░\n100┤    ░░░░░░░░████░░░░░░░░░░░░░░░░░░░░░░████░░░░░░░░░░░░\n 50┤    ░░░░░░██████░░░░░░░░░░░░░░░░░░░░██████░░░░░░░░░░░░\n 20┤    ░░░░░░░░██░░░░░░░░░░░░░░░░░░░░░░░░██░░░░░░░░░░░░░░\n 10┤    ░░░░░░░░░░░░░░░░░░▓▓▓▓░░░░░░░░░░░░░░░░░░░░▓▓▓▓░░░░\n  5┤    ░░████░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░\n  3┤    ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░\n  └────────────────────────────────────────────────────────\n       ↑        ↑                    ↑        ↑\n    pac site   Repeat              pac site  Repeat\n     (170bp)   cluster              (170bp)  cluster\n\nLegend: ░ low power  ▒ medium  ▓ high  █ very high\n\n───────────────────────────────────────────────────────────────────────────────\n\nSIGNIFICANT PERIODICITIES DETECTED:\n┌─────────────┬─────────────────────────────────────────────────────────────┐\n│ Period (bp) │ Interpretation                                               │\n├─────────────┼─────────────────────────────────────────────────────────────┤\n│ 170 ± 5     │ ★ PACKAGING SIGNAL (T4 pac site periodicity)                │\n│             │   Positions: 19.2 kb, 134.5 kb (headful packaging markers)  │\n├─────────────┼─────────────────────────────────────────────────────────────┤\n│ 10-11       │ ★ PROMOTER SPACING (sigma-70 binding sites)                 │\n│             │   Clustered in early gene region (0-50 kb)                  │\n├─────────────┼─────────────────────────────────────────────────────────────┤\n│ 5-6         │ Codon periodicity (expected for coding regions)             │\n│             │   Weak signal, distributed throughout                        │\n└─────────────┴─────────────────────────────────────────────────────────────┘\n\n───────────────────────────────────────────────────────────────────────────────\n\nTANDEM REPEATS FOUND:\n┌──────────────┬─────────┬────────┬───────────────────────────────────────────┐\n│ Position     │ Period  │ Copies │ Unit Sequence                              │\n├──────────────┼─────────┼────────┼───────────────────────────────────────────┤\n│ 45,230       │ 12 bp   │ 8      │ GCTGAAGCTGAA (microsatellite)             │\n│ 78,901       │ 42 bp   │ 5      │ ATCG... (minisatellite, baseplate gene)   │\n│ 112,456      │ 170 bp  │ 2      │ (partial pac site duplication)            │\n└──────────────┴─────────┴────────┴───────────────────────────────────────────┘\n\n[P] Jump to strongest period   [R] Show repeat details   [Z] Zoom   [ESC] Exit\n```\n\n### Why This Is Good\n\n1. **Hidden signal detection**: Periodicities invisible in sequence become obvious in spectrogram.\n2. **Packaging mechanism**: pac sites have characteristic periodicity — this reveals them.\n3. **Repeat evolution**: VNTRs are hotspots for phage variation.\n4. **Regulatory architecture**: Promoter spacing reveals transcriptional organization.\n5. **Wavelet spectrograms in TUI are highly unusual**: Novel visualization.\n\n### Innovation Assessment\n\n**Novelty: HIGH** - Wavelet analysis exists for DNA (academic tools), but Braille spectrogram rendering in a terminal is completely novel. Interactive exploration with jump-to-period is new.\n\n**Pedagogical Value: 8/10** - Teaches spectral analysis, wavelet transforms, periodicity detection, tandem repeat biology.\n\n**Wow Factor: 9/10** - Braille spectrogram is visually striking; pressing 'P' jumps to the genomic region with strongest periodic signal.\n\n### Dependencies\n- Rust/WASM for CWT/FFT (~5MB with realfft crate)\n- phage_explorer-54g (Menu Infrastructure)","status":"open","priority":3,"issue_type":"feature","created_at":"2025-12-06T23:53:22.418534-05:00","updated_at":"2025-12-06T23:53:22.418534-05:00","dependencies":[{"issue_id":"phage_explorer-axn","depends_on_id":"phage_explorer-54g","type":"blocks","created_at":"2025-12-06T23:56:51.351465-05:00","created_by":"daemon"}]}
{"id":"phage_explorer-be3","title":"Advanced: Phage-Defense Arms Race Scanner","description":"## Phage-Defense Arms Race Scanner (Advanced Feature)\n\n### Concept\n\nBacteria and phages are locked in an **eternal arms race**. Bacteria evolve elaborate defense systems — CRISPR-Cas, restriction-modification (RM), abortive infection (Abi), retrons, CBASS, Thoeris, and more. Phages counter with anti-defense genes — anti-CRISPRs, methyltransferases that evade RM, Abi inhibitors.\n\nThis scanner identifies both sides of the battle:\n1. **Phage offense**: What anti-defense genes does this phage carry?\n2. **Host defense** (if known): What systems protect the host?\n3. **Matchup prediction**: Which defenses is this phage equipped to overcome?\n\nThe result is a \"combat readiness\" profile showing the phage's arsenal against the known bacterial defense landscape.\n\n### Mathematical Foundations\n\n**HMM profile scoring for anti-defense genes:**\n```\nFor each anti-defense family F (e.g., AcrIF, Ocr, Dam):\n  - Curated HMM profile from literature\n  - Score each phage protein against profile\n  - E-value \u003c 1e-5 = significant hit\n\nConfidence scoring:\n  - Bit score \u003e trusted cutoff (TC) = high confidence\n  - Bit score \u003e noise cutoff (NC) = medium confidence\n  - Below NC = spurious\n```\n\n**Defense system detection in hosts:**\n```\nFor bacterial genomes, detect:\n  - CRISPR arrays: CRT/PILER-CR detection\n  - Cas proteins: Cas-typing via CasTyper profiles\n  - RM systems: REBASE profiles\n  - Abi systems: Abi-specific HMMs\n  - Retrons, CBASS, Thoeris: Recent HMM collections\n\nCreate defense profile D = {d₁, d₂, ..., dₙ}\n```\n\n**Offense-Defense compatibility matrix:**\n```\nKnown interactions (from literature):\n  M[offense, defense] =\n    +1 if offense neutralizes defense\n    -1 if defense blocks phage (no counter)\n     0 if no known interaction\n\nPhage \"escape score\" vs host:\n  S = Σᵢ M[phage_offense_i, host_defense_j] / |host_defenses|\n\nS \u003e 0.5: Phage likely to infect\nS \u003c 0: Phage likely blocked\n```\n\n**Anti-defense gene catalog:**\n```\nMajor families:\n  Anti-CRISPR:\n    - AcrIF (Inhibits Cas3/Cas10), AcrIIA (Cas9), AcrIE (Type I-E), AcrVA (Cas12a)\n  Anti-RM:\n    - Dam/Dcm methyltransferases (pre-methylate DNA)\n    - Ocr (T7 protein that mimics DNA, sequesters EcoKI)\n    - DarB (blocks EcoKI restriction)\n  Anti-Abi:\n    - Gene-specific inhibitors (Arn for Rex system, etc.)\n  Other:\n    - dGTPase inhibitors, SOS response suppressors\n```\n\n### Implementation Approach\n\n**Anti-defense HMM profiles:**\n```typescript\ninterface AntiDefenseProfile {\n  id: string;\n  name: string;\n  targetDefense: string;\n  mechanism: string;\n  hmmPath: string;\n  trustedCutoff: number;\n  noiseCutoff: number;\n  references: string[];\n}\n\n// Example profiles bundled with app\nconst ANTI_DEFENSE_PROFILES: AntiDefenseProfile[] = [\n  {\n    id: 'AcrIF1',\n    name: 'Anti-CRISPR AcrIF1',\n    targetDefense: 'CRISPR-Cas Type I-F',\n    mechanism: 'Binds Cas3 helicase, blocks DNA degradation',\n    trustedCutoff: 25.0,\n    noiseCutoff: 15.0,\n    references: ['Bondy-Denomy 2013']\n  },\n  {\n    id: 'Ocr',\n    name: 'T7 Ocr (Overcome Classical Restriction)',\n    targetDefense: 'Type I RM (EcoKI)',\n    mechanism: 'DNA mimic, sequesters EcoKI enzyme',\n    trustedCutoff: 40.0,\n    references: ['Walkinshaw 2002']\n  },\n  // ... more profiles\n];\n```\n\n**Host defense profiling:**\n```typescript\ninterface DefenseSystem {\n  type: 'CRISPR' | 'RM' | 'Abi' | 'Retron' | 'CBASS' | 'Thoeris' | 'Other';\n  subtype: string;  // e.g., 'Type I-E', 'Type IIG'\n  genes: string[];\n  spacerCount?: number;  // For CRISPR\n  recognitionSite?: string;  // For RM\n  confidence: number;\n}\n```\n\n**Matchup computation:**\n```typescript\ninterface ArmsRaceMatchup {\n  phageId: number;\n  hostId: string;\n  phageOffense: AntiDefenseHit[];\n  hostDefense: DefenseSystem[];\n  neutralizedDefenses: { defense: DefenseSystem; by: AntiDefenseHit }[];\n  activeDefenses: DefenseSystem[];\n  escapeScore: number;  // -1 to +1\n  prediction: 'likely_infects' | 'uncertain' | 'likely_blocked';\n}\n```\n\n### TUI Visualization\n\n```\nPhage-Defense Arms Race: T4 vs E. coli K-12\n═══════════════════════════════════════════════════════════════════════════════\n\nPHAGE OFFENSE                          HOST DEFENSE\n(Anti-defense arsenal)                 (Immune systems)\n\n┌─────────────────────────┐            ┌─────────────────────────┐\n│ ⚔ Dam methyltransferase │───────────▶│ ⛡ EcoKI (Type I RM)    │ ✓ BLOCKED\n│   Confidence: ████████░░│            │   Recognition: AACNNNNNNGTGC\n│   Mechanism: Pre-        │            │   Status: NEUTRALIZED   │\n│   methylates GATC sites  │            │                         │\n└─────────────────────────┘            └─────────────────────────┘\n\n┌─────────────────────────┐            ┌─────────────────────────┐\n│ ⚔ ModA (Alt-like)       │───────────▶│ ⛡ EcoRV (Type II RM)   │ ✓ BLOCKED\n│   Confidence: ███████░░░│            │   Recognition: GATATC   │\n│   Mechanism: DNA         │            │   Status: NEUTRALIZED   │\n│   modification           │            │                         │\n└─────────────────────────┘            └─────────────────────────┘\n\n                    ╳                  ┌─────────────────────────┐\n       NO COUNTER FOUND ◀──────────────│ ⛡ CRISPR-Cas I-E       │ ⚠ ACTIVE\n                                       │   Spacers: 12 (2 match) │\n                                       │   Status: THREAT!       │\n                                       └─────────────────────────┘\n\n───────────────────────────────────────────────────────────────────────────────\n\nBATTLE ASSESSMENT\n┌─────────────────────────────────────────────────────────────────────────────┐\n│  Defenses neutralized:  3/4 (75%)                                           │\n│  Active threats:        1 (CRISPR-Cas I-E with matching spacers)            │\n│                                                                              │\n│  Escape Score: ████████░░ +0.50                                             │\n│  Prediction: UNCERTAIN ⚠                                                    │\n│                                                                              │\n│  Notes:                                                                      │\n│  - T4 lacks anti-CRISPR genes (typical for T4-like phages)                  │\n│  - 2 CRISPR spacers match T4 sequences (gp23, gp34)                         │\n│  - Infection may succeed if CRISPR interference is incomplete               │\n└─────────────────────────────────────────────────────────────────────────────┘\n\nGene Map with Defense Annotations:\n──[rIIA]──[Alt]──[ModA]──[Dam]────────[Arn]──────────────────────────\n    │       │      │       │            │\n   Abi     RM     RM      RM          Abi\n  evasion bypass bypass  bypass      evasion\n\n[H] Change host   [D] Defense details   [G] Show gene   [ESC] Exit\n```\n\n### Why This Is Good\n\n1. **Therapeutic selection**: For phage therapy, need phages that overcome target pathogen's defenses.\n2. **Evolutionary insight**: Anti-defense genes are hotspots of phage-bacteria coevolution.\n3. **Defense landscape mapping**: Understanding host defenses helps predict susceptibility.\n4. **Discovery catalyst**: Unknown genes adjacent to known anti-defense may be novel countermeasures.\n5. **No existing tool**: Defense-Anti-Defense pairing is currently done manually.\n\n### Innovation Assessment\n\n**Novelty: HIGH** - Tools exist for CRISPR (CRISPRCasFinder), RM (REBASE), anti-CRISPR (AcrFinder) separately, but no tool integrates all defense types, provides \"matchup\" prediction, or has TUI visualization.\n\n**Pedagogical Value: 10/10** - Teaches CRISPR-Cas, restriction-modification, abortive infection, anti-CRISPRs, and coevolution (Red Queen's race).\n\n**Wow Factor: 9/10** - Seeing phage's \"combat loadout\" against host's \"defense grid\" with matches/mismatches makes molecular warfare tangible.\n\n### Data Requirements\n- Curated anti-defense HMM profiles (~20 families)\n- Defense system detection profiles (REBASE, CasTyper)\n- Host genome annotations (optional, for matchup)","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-06T23:20:17.595944-05:00","updated_at":"2025-12-06T23:45:05.646139-05:00","dependencies":[{"issue_id":"phage_explorer-be3","depends_on_id":"phage_explorer-54g","type":"blocks","created_at":"2025-12-06T23:20:17.596973-05:00","created_by":"daemon"}]}
{"id":"phage_explorer-bp9","title":"Advanced: Codon Economy \u0026 tRNA Adaptation Dashboard","description":"## Codon Economy \u0026 tRNA Adaptation Dashboard\n\n### Concept\nQuantify translation efficiency per gene vs host tRNA pool; surface codon-pair bias hotspots. Phages must balance:\n- Fast translation (use common codons)\n- Regulatory pauses (use rare codons strategically)\n- Host adaptation (optimize for specific host)\n\nThis feature merges host-specific translational constraints with phage engineering hints.\n\n### Key Metrics\n\n**Codon Adaptation Index (CAI):**\n- Match to highly expressed host genes\n- CAI = geometric mean of relative adaptiveness per codon\n- Range: 0-1, higher = better adapted\n\n**tRNA Adaptation Index (tAI):**\n- Match to host tRNA abundance (gene copy numbers)\n- More direct measure of translation speed\n- Requires tRNA gene copy number data per host\n\n**Codon Pair Bias (CPB):**\n- Some codon pairs are disfavored (ribosome stalling)\n- CPB = log(observed/expected) for each pair\n- \"Redlines\" = highly disfavored pairs (|CPB| \u003e 1.5)\n\n### Implementation\n\nPull tRNA gene copy numbers from GtRNAdb:\nconst HOST_TRNA_WEIGHTS: Map\u003cstring, Map\u003cstring, number\u003e\u003e = loadTRNAWeights();\n\nCompute metrics per gene:\n- computeCAI(gene: string, hostId: string) → number\n- computeTAI(gene: string, hostId: string) → number\n- computeCodonPairBias(gene: string) → CodonPairResult[]\n\nHeavy loops can be moved to Rust+WASM.\nStore per-gene metrics in SQLite; recompute on host switch.\n\n### TUI Visualization\n\n**Gene map heatmap (colored by CAI):**\n═══[cI]════[N]════[cro]════[O]════[P]════[Q]════[gpJ]═══\n   ▓▓▓    ███    ▓▓▓     ███    ███    ██░    ░░░░░░░\n  0.65    0.89   0.72    0.85   0.88   0.78    0.45\n\nLegend: ░ Low CAI (\u003c0.5)  ▓ Medium  █ High (\u003e0.8)\n\n**Codon Pair \"Redlines\" view (press 'c'):**\nShow disfavored codon pairs along sequence grid\nPosition 234: GGA-CGA (bias -2.1) ← ribosome stall site?\nPosition 567: AGG-CGA (bias -2.4) ← rare codon cluster\n\n**Host comparison table:**\n              E.coli K12  Salmonella  Shigella\nOverall CAI:   0.72        0.68       0.71\nTail fiber:    0.45        0.61       0.48  ← adapted to Salmonella?\n\n### Engineering Hints\n- Low CAI genes = candidates for codon optimization\n- Rare codon clusters = potential regulatory pauses\n- Different CAI across hosts = host adaptation evidence\n\n### Pedagogical Value: 9/10\nTeaches codon bias biology, translation efficiency, host adaptation, genetic code degeneracy, expression tuning.\n\n### Data Requirements\n- tRNA gene copy numbers per host species (from GtRNAdb)\n- Codon usage tables per host\n- ~10MB additional data\n\n### Dependencies\n- phage_explorer-54g (Menu Infrastructure)","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-06T23:19:11.419742-05:00","updated_at":"2025-12-06T23:32:51.611507-05:00","dependencies":[{"issue_id":"phage_explorer-bp9","depends_on_id":"phage_explorer-54g","type":"blocks","created_at":"2025-12-06T23:19:11.421645-05:00","created_by":"daemon"}]}
{"id":"phage_explorer-c3j","title":"Layer 2: Genomic Signature PCA (Tetranucleotide Frequency)","description":"Compute tetranucleotide (4-mer) frequencies for all phages (256 dimensions) and project into 2D using PCA for alignment-free phylogenetics. Clustering reveals family relationships, host adaptation patterns, and outliers. PC1 typically correlates with GC content (30-50% variance), PC2 with purine/pyrimidine bias. O(n) per genome computation. Interactive scatter plot with clustering annotations. Novelty: 7/10, Pedagogical: 9/10, Cool Factor: 8/10.","notes":"## GENOMIC SIGNATURE PCA (TETRANUCLEOTIDE FREQUENCY)\n\n**Comprehensive Feature Specification from Roadmap**\n\n### Concept\nEvery genome has a characteristic \"signature\" - unique k-mer frequency pattern reflecting evolutionary history, GC content, codon usage. By computing tetranucleotide frequencies for all phages and projecting via PCA, visualize phylogenetic relationships WITHOUT sequence alignment.\n\n**Power of Genomic Signatures**:\n- Alignment-free comparison - works even for divergent sequences\n- Captures global composition, not just individual gene homology\n- Robust to rearrangements, insertions, deletions\n- Fast: O(n) per genome\n\n**What PCA Reveals**:\n- Clustering by family: Related phages cluster together\n- Host adaptation: Phages infecting same host cluster (shared codon biases)\n- Outliers: Unusual or chimeric genomes stand out\n- GC islands: Horizontally transferred regions have different signatures\n\n### Mathematical Foundations\n\n**Tetranucleotide Frequency Vector**:\nFor genome S of length L:\n- Count each 4-mer: freq(AAAA), freq(AAAC), ..., freq(TTTT)\n- Total 4-mers: 4^4 = 256 possibilities\n- Normalize: f(k) = count(k) / (L - 3)\n\n**Principal Component Analysis**:\nGiven N phages, each with 256-dim frequency vector:\nData matrix X: N x 256\n\n1. Center: X_centered = X - mean(X, axis=0)\n2. Covariance: C = (1/N) * X_centered^T * X_centered [256 x 256]\n3. Eigendecomposition: C = V * Lambda * V^T\n4. Project to 2D: PC1 = X_centered * v1, PC2 = X_centered * v2\n\n**Variance Explained**:\nVariance by PCk = lambda_k / sum(lambda_i)\nTypically:\n- PC1: 30-50% (often correlates with GC content)\n- PC2: 10-20% (often reflects purine/pyrimidine bias)\n\n**Distance in PCA Space**:\nd(i,j) = sqrt((PC1_i - PC1_j)^2 + (PC2_i - PC2_j)^2)\nCorrelates with taxonomic distance, host range overlap, divergence time\n\n### Implementation\n\n**Core Interfaces**:\n```typescript\ninterface KmerVector {\n  phageId: number;\n  name: string;\n  frequencies: Float32Array;  // 256 elements\n  gcContent: number;\n}\n\ninterface PCAResult {\n  projections: { phageId: number; name: string; pc1: number; pc2: number }[];\n  eigenvalues: number[];\n  varianceExplained: number[];\n  loadings: Float32Array[];  // Which 4-mers contribute to each PC\n}\n```\n\n**computeKmerFrequencies()**: Single pass through sequence, encode 4-mers as indices 0-255, count and normalize\n\n**computePCA()**: Center data, power iteration for top eigenvectors, project data\n\n**renderPCAPlot()**: ASCII scatter plot with axes, point labels, cluster annotations\n\n### TUI Visualization\n\n```\n╭───────────────────────────────────────────────────────────────────────────╮\n│  GENOMIC SIGNATURE PCA: Tetranucleotide Frequencies                      │\n├───────────────────────────────────────────────────────────────────────────┤\n│                                                                           │\n│  PC1 (43.2% variance) vs PC2 (16.7% variance)                            │\n│                                                                           │\n│  PC2 ↑                                                                    │\n│      │                                                                    │\n│  0.3 │                    ●T7                                             │\n│      │                   ● ●                   ●Phi29                     │\n│  0.2 │                  ●   (T7-like)            ●                        │\n│      │                 ●                                                  │\n│  0.1 │                                                                    │\n│      │  ●MS2                                                              │\n│  0.0 │───────────────────────────────────●Lambda───────────────→ PC1     │\n│      │       ●PhiX174                        ●                            │\n│ -0.1 │         (ssDNA cluster)              ●P22                          │\n│      │      ●M13                                                          │\n│ -0.2 │                                                                    │\n│      │                                        ◉ YOU ARE HERE              │\n│ -0.3 │                           ●T4           (T4-like cluster)          │\n│      │                          ●SPbeta ●T5                               │\n│ -0.4 └──────────────────────────────────────────────────────────          │\n│     -0.4  -0.3  -0.2  -0.1   0.0   0.1   0.2   0.3   0.4   0.5            │\n│                                                                           │\n│  Clusters: T7-like (high GC) | T4-like (AT-rich) | ssDNA | Lambda-like   │\n│  [Click] Inspect  [Z] Zoom  [3] Add PC3  [E] Export  [ESC] Exit          │\n╰───────────────────────────────────────────────────────────────────────────╯\n```\n\n### Assessment\n- Novelty: 7/10 - Technique known but rarely in user-facing phage tools, TUI scatter novel\n- Pedagogical: 9/10 - Teaches PCA, genomic signatures, alignment-free methods, multivariate stats\n- Cool Factor: 8/10 - Proximity = relatedness is satisfying visualization\n\n### Files\n- packages/tui/src/components/PCAView.tsx\n- packages/core/src/analysis/kmer-frequencies.ts\n- packages/core/src/analysis/pca.ts","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-06T23:15:45.104077-05:00","updated_at":"2025-12-07T00:08:37.368039-05:00","dependencies":[{"issue_id":"phage_explorer-c3j","depends_on_id":"phage_explorer-54g","type":"blocks","created_at":"2025-12-06T23:15:45.105973-05:00","created_by":"daemon"}]}
{"id":"phage_explorer-c95","title":"Layer 2: Virtual Agarose Gel Electrophoresis","description":"Classic molecular biology technique in terminal. Select restriction enzymes, digest phage genomes in silico, visualize DNA fragments as ASCII gel bands with size ladder and log-linear migration. Features enzyme database (EcoRI, HindIII, BamHI, etc.), cut site mapping, double digest support, multi-genome comparison. Bridges wet lab and dry lab - predict gel results before experiments. Novelty: 6/10, Pedagogical: 8/10, Cool Factor: 7/10.","notes":"## VIRTUAL AGAROSE GEL ELECTROPHORESIS\n\n**Comprehensive Feature Specification from Roadmap**\n\n### Concept\nClassic molecular biology technique brought to terminal. Select restriction enzymes, digest phage genomes in silico, visualize fragments as bands on virtual gel with size ladder and realistic migration.\n\n**Why for Phage Research**:\n- Experimental planning: Predict gel before spending reagents\n- Strain verification: Restriction patterns as phage fingerprints\n- Genetic mapping: Quick localization technique\n- Cloning design: Find suitable restriction sites\n- Teaching: Visualize sequence-to-fragment relationship\n\n**Physics**: DNA negative charge (phosphate) migrates to positive electrode. Agarose sieve - small fragments faster. Migration ~ linear with log(size).\n\n### Mathematical Foundations\n\n**Restriction Site Finding**:\n- Match recognition sequence with cut offset\n- Handle palindromic sequences\n- Degenerate bases (N, Y, R, W, S, K, M)\n- Common enzymes: EcoRI (GAATTC), HindIII (AAGCTT), BamHI (GGATCC), NotI (GCGGCCGC), HaeIII (GGCC)\n\n**Fragment Generation**:\nLinear: fragments between cuts plus ends\nCircular: last fragment wraps to first cut\n\nDouble digest: merge cut sites, sort, generate fragments\n\n**Migration (Ogston Model)**:\nlog10(L) = a - b * d\nd = (a - log10(L)) / b\n\nTypical 1% agarose: a ~ 4.5, b ~ 0.05\n\nResolution limits: \u003c200bp poor, \u003e20kb compress (need PFGE)\n\n**Band Intensity**:\nI proportional to mass (copies x length)\nSingle digest: all fragments equal copy, I ~ length\n\n**Expected Fragments**:\n6-cutter: ~4096bp average spacing\nLambda 48.5kb: ~12 EcoRI fragments expected\n\n### Implementation\n\n**Enzyme Database**:\nRestrictionEnzyme: name, recognitionSite, cutOffset, overhang (5/3/blunt), frequency\n\nIUPAC degenerate base regex conversion\n\n**Digestion Engine**:\ndigestGenome(sequence, enzymeName, circular): DigestResult with cutSites[], fragments[], mapData\n\ngenerateCutMap(): Text-based scale with cut position markers\n\n**Gel Renderer**:\nGelConfig: width, height, lanes[], ladder[], concentration\n\nrenderGel(): ASCII gel with wells, ladder bands, sample bands\n- Ladder: reference sizes with thin bands\n- Samples: band width proportional to log(size) for intensity\n- Lane labels below\n\n### TUI Visualization\n\nMain view:\n- Enzyme selector dropdown\n- Cut map showing positions on genome\n- Virtual gel with ladder and sample lanes\n- Fragment table (sizes sorted)\n\nDouble digest view:\n- Side-by-side single and double digest\n- Shows increased resolution with more fragments\n\n### Assessment\n- Novelty: 6/10 - Virtual gel exists but TUI + ASCII art novel\n- Pedagogical: 8/10 - Restriction enzymes, log-linear, gel interpretation\n- Cool Factor: 7/10 - Satisfying to see virtual gel appear in terminal\n\n### Files\n- packages/tui/src/components/GelView.tsx\n- packages/core/src/analysis/restriction-digest.ts\n- packages/core/src/data/restriction-enzymes.ts","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-06T23:15:45.679687-05:00","updated_at":"2025-12-07T00:03:32.788395-05:00","dependencies":[{"issue_id":"phage_explorer-c95","depends_on_id":"phage_explorer-54g","type":"blocks","created_at":"2025-12-06T23:15:45.680152-05:00","created_by":"daemon"}]}
{"id":"phage_explorer-cgd","title":"Layer 1: Promoter/RBS Strength Overlay [P key]","description":"Layer 1 overlay (P key): Display predicted promoter (-35/-10 boxes) and RBS (Shine-Dalgarno) strength annotations. Pattern matching against consensus sequences. Understanding gene expression timing. Priority: P2.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-06T23:10:41.106532-05:00","updated_at":"2025-12-07T00:14:30.546386-05:00","closed_at":"2025-12-07T00:14:30.546386-05:00","dependencies":[{"issue_id":"phage_explorer-cgd","depends_on_id":"phage_explorer-2g5","type":"blocks","created_at":"2025-12-06T23:10:41.108052-05:00","created_by":"daemon"}]}
{"id":"phage_explorer-cgh","title":"Layer 3: Plaque Growth Cellular Automata","description":"Cellular automaton simulating phage plaque formation on bacterial lawns. Input phage parameters (burst size, latent period, lysogeny probability, diffusion rate) and watch virtual plaques grow in real-time. Models reaction-diffusion: bacteria grow, phages infect, cells lyse after latent period releasing burst, phages diffuse. Explains clear vs turbid plaques, size determinants. Novelty: 9/10, Pedagogical: 9/10, Cool Factor: 10/10.","notes":"## PLAQUE MORPHOLOGY CELLULAR AUTOMATA\n\n**Comprehensive Feature Specification from Roadmap**\n\n### Concept\nSimulate phage plaque formation using cellular automaton, connecting genotype (molecular parameters) to phenotype (observable plaque morphology).\n\n**Biology of Plaque Formation**:\n- Bacteria grow as lawn on solid media\n- Single phage infects one bacterium\n- After latent period, cell lyses releasing burst_size new phages\n- Phages diffuse outward, infect neighbors\n- Process repeats, creating expanding dead zone (plaque)\n\n**What Determines Morphology**:\n- Clear plaques: Virulent phages that always lyse\n- Turbid plaques: Temperate phages, lysogens survive in center\n- Large plaques: Long latent period (more diffusion time before lysis)\n- Small plaques: Short latent period (lysis before diffusion)\n- Halo plaques: Phages with depolymerase activity\n\n### Mathematical Foundations\n\n**Reaction-Diffusion Model**:\nState variables at (x,y,t):\n- B(x,y,t) = bacteria density [0,1]\n- I(x,y,t) = infected cell count\n- P(x,y,t) = free phage particles\n\nEquations:\ndB/dt = r*B*(1-B) - k*B*P        [growth - infection]\ndI/dt = k*B*P - (1/tau)*I        [infection - lysis]\ndP/dt = D*grad^2(P) + b*(1/tau)*I - delta*P  [diffusion + burst - decay]\n\nParameters: r=growth, k=adsorption, tau=latent period, b=burst size, D=diffusion, delta=decay\n\n**Cellular Automaton Simplification**:\nEach cell per tick:\n- BACTERIA: if adjacent PHAGE, become INFECTED with prob p; else stay/divide\n- INFECTED: age++; if age \u003e= latent_period: LYSED, spawn burst_size phages nearby\n- LYSED: stay dead\n- LYSOGEN: immune, can grow (temperate phages)\n\n**Plaque Size Prediction**:\nR ~ sqrt(4 * D * T * efficiency)\nPlaque area proportional to (burst_size * latent_period * D) / adsorption\n\n### Implementation\n\n**Core Interfaces**:\n```typescript\ntype CellState = 'empty' | 'bacteria' | 'infected' | 'lysed' | 'lysogen';\n\ninterface PlaqueSimConfig {\n  gridSize: number;           // NxN grid\n  burstSize: number;          // Phages per lysis\n  latentPeriod: number;       // Ticks until lysis\n  diffusionRate: number;      // Phage movement\n  adsorptionProb: number;     // Infection probability\n  lysogenyProb: number;       // Lysogen probability (temperate)\n  bacteriaGrowthRate: number; // Division probability\n}\n\ninterface SimulationCell {\n  state: CellState;\n  phageCount: number;\n  infectionAge: number;\n}\n```\n\n**initializePlaqueSim()**: Create grid of bacteria, seed single phage at center\n\n**simulateTick()**: \n- Process each cell by state\n- Handle infection, lysis, phage release\n- Diffuse phages to neighbors\n- Update grid\n\n**distributePhages()**: Spread burst_size phages in random directions within 3-cell radius\n\n**renderPlaque()**: Convert cell states to ASCII: bacteria=block, infected=dark shade, lysed=space, lysogen=light shade\n\n### TUI Visualization\n\n```\n╭───────────────────────────────────────────────────────────────────────────╮\n│  PLAQUE MORPHOLOGY SIMULATOR: Lambda Phage                               │\n├───────────────────────────────────────────────────────────────────────────┤\n│                                                                           │\n│  Parameters:         Time: 00:45    Generation: 3                        │\n│  ├─ Burst size: 100                                                       │\n│  ├─ Latent period: 45 min                                                 │\n│  ├─ Lysogeny: 50%                                                         │\n│  └─ Diffusion: Medium                                                     │\n│                                                                           │\n│  ┌─────────────────────────────────────────────────────────────────────┐  │\n│  │█████████████████████████████████████████████████████████████████████│  │\n│  │████████████████████████████▓▓▓██████████████████████████████████████│  │\n│  │██████████████████████████▓▓   ▓▓████████████████████████████████████│  │\n│  │████████████████████████▓▓  ▒▒  ▓▓██████████████████████████████████│  │\n│  │███████████████████████▓  ▒    ▒  ▓█████████████████████████████████│  │\n│  │██████████████████████▓ ▒  ▒▒▒  ▒ ▓█████████████████████████████████│  │\n│  │█████████████████████▓ ▒ ▒     ▒ ▒ ▓████████████████████████████████│  │\n│  │█████████████████████▓ ▒   ▒▒▒  ▒  ▓████████████████████████████████│  │\n│  │██████████████████████▓ ▒ ▒   ▒ ▒ ▓█████████████████████████████████│  │\n│  │███████████████████████▓  ▒▒▒▒▒  ▓██████████████████████████████████│  │\n│  │████████████████████████▓▓     ▓▓███████████████████████████████████│  │\n│  │██████████████████████████▓▓▓▓▓█████████████████████████████████████│  │\n│  │█████████████████████████████████████████████████████████████████████│  │\n│  └─────────────────────────────────────────────────────────────────────┘  │\n│                                                                           │\n│  Legend: █ Bacteria | ▓ Infected | (space) Lysed | ▒ Lysogen             │\n│                                                                           │\n│  Morphology: TURBID (lysogens surviving in center)                       │\n│  Predicted size: Medium (2.1 mm at 24h)                                  │\n│                                                                           │\n│  [Space] Pause  [B/L/D] Adjust params  [R] Reset  [V] Virulent  [ESC]    │\n╰───────────────────────────────────────────────────────────────────────────╯\n```\n\n### Assessment\n- Novelty: 9/10 - Cellular automata for plaques exists in research but never in phage tools, real-time TUI unique\n- Pedagogical: 9/10 - Teaches phage lifecycle, population dynamics, mathematical biology, emergence\n- Cool Factor: 10/10 - Essentially a video game, watching infection spread is addictive\n\n### Files\n- packages/tui/src/components/PlaqueSimView.tsx\n- packages/core/src/simulation/plaque-automata.ts\n- packages/core/src/simulation/plaque-config.ts","status":"open","priority":3,"issue_type":"feature","created_at":"2025-12-06T23:17:07.628557-05:00","updated_at":"2025-12-07T00:09:27.904816-05:00","dependencies":[{"issue_id":"phage_explorer-cgh","depends_on_id":"phage_explorer-ojb","type":"blocks","created_at":"2025-12-06T23:17:07.629569-05:00","created_by":"daemon"}]}
{"id":"phage_explorer-cu3","title":"Advanced: Metagenomic Co-Occurrence \u0026 Niche Profiler","description":"Infer ecological niches and co-occurring taxa from metagenomic abundance tables. SparCC/FlashWeave-like compositional correlations + NMF for latent niche vectors. Co-occurrence network colored by niches, habitat filters, significance thresholds. Adds real-world context to host predictions. Novelty: Medium-high, Pedagogical: High (compositional stats, niche ecology).","notes":"## METAGENOMIC CO-OCCURRENCE \u0026 ECOLOGICAL NICHE PROFILER\n\n### Concept\nInfer ecological niches and co-occurring taxa from metagenomic abundance tables; derive niche vectors and networks.\n\n### How to Build\n- **Input**: BIOM/TSV + sample metadata\n- **Correlations**: SparCC/FlashWeave-like compositional inference in Rust+WASM (ndarray + rayon)\n- **Niche factors**: NMF/PMF in TS for latent \"niche vectors\"\n- **Metadata mapping**: Attach habitats/hosts to factors; cache per phage\n- **UI**: Co-occurrence network colored by niches; stacked niche bars per phage; filters by habitat\n\n### Why It's Good\nAdds real-world context to host predictions; complements CRISPR/prophage evidence.\n\n### Implementation Stack\nRust+WASM for correlations; TS NMF; SQLite cache of niche vectors; BIOM parser in TS.\n\n### TUI Visualization\nNetwork with niche colors; press 'n' to repaint bars; tooltips show top co-occurring taxa/habitats; toggle significance threshold live.\n\n### Files\n- packages/core/src/analysis/metagenomic-niche.ts\n- packages/tui/src/components/NicheNetworkView.tsx","status":"open","priority":3,"issue_type":"feature","created_at":"2025-12-06T23:51:11.070369-05:00","updated_at":"2025-12-07T00:15:39.340902-05:00","dependencies":[{"issue_id":"phage_explorer-cu3","depends_on_id":"phage_explorer-54g","type":"blocks","created_at":"2025-12-06T23:56:51.160196-05:00","created_by":"daemon"}]}
{"id":"phage_explorer-dx3","title":"Foundation: UI Design System \u0026 Visual Language","description":"## UI Design System \u0026 Visual Language\n\nEstablishes coherent visual language across all 31 features to maintain consistency.\n\n### Color Semantics\n- Green (#22c55e): Good, conserved, stable, similar\n- Yellow (#eab308): Caution, moderate, neutral\n- Red (#ef4444): Warning, divergent, unstable, different\n- Blue (#3b82f6): Informational, cool metrics\n- Purple (#a855f7): Special, unique, notable\n- Gray (#6b7280): Inactive, background, reference\n\n### Graph/Sparkline Standards\n- Height: 3-5 character rows for overlays\n- Width: Full terminal width\n- Scale: Auto-normalize, show min/max in labels\n- Style: Braille dots for high resolution\n\n### Panel/Modal Standards\n- Border: Single line box drawing\n- Header: Bold, centered, with close hint\n- Padding: 1 character on all sides\n- Max width: 80 characters (or terminal width - 4)\n\nThis is the foundational design system that all features must follow.","status":"closed","priority":0,"issue_type":"epic","created_at":"2025-12-06T23:35:34.98277-05:00","updated_at":"2025-12-06T23:58:14.201697-05:00","closed_at":"2025-12-06T23:58:14.201697-05:00"}
{"id":"phage_explorer-ea3","title":"Foundation: Depth Layers UI Philosophy \u0026 Keybinding Conventions","description":"## Depth Layers UI Philosophy \u0026 Keybinding Conventions\n\n### Core Philosophy\n\nPhage Explorer must serve two audiences:\n1. **Newcomers** who need simplicity and discoverability\n2. **Power users** who need speed and comprehensive access\n\nThe solution: **Depth Layers** — a progressive disclosure system where features are organized by access frequency and complexity.\n\n### The Five Layers\n\n```\nLayer 0: Sacred Surface (12 core controls)\n  ↓ Always visible, never change\nLayer 1: Quick Overlays (5 single-key toggles)\n  ↓ One keypress, instant visual augmentation\nLayer 2: Analysis Menu (A key)\n  ↓ Categorized selection, ~15 analyses\nLayer 3: Simulation Hub (Shift+S)\n  ↓ Interactive simulations, 5 tools\nLayer 4: Command Palette (: or Ctrl+P)\n  ↓ Fuzzy search everything, 31+ features\n```\n\n### Layer 0: Sacred Surface (NEVER CHANGE)\n\nThese 12 controls are the foundation. New users learn these first.\n\n```\nNAVIGATION:\n  ↑/↓       Navigate phages\n  ←/→       Scroll sequence\n  PgUp/PgDn Fast scroll\n  Home/End  Jump to start/end\n\nVIEW CONTROLS:\n  N/C/Space Toggle DNA/AA view\n  F         Cycle reading frame (AA mode)\n  T         Cycle theme\n  D         Toggle diff mode\n  M         Toggle 3D model\n\nMETA:\n  ?         Help overlay\n  S or /    Search phages\n  Q         Quit\n```\n\n**RULE**: These keys MUST remain unchanged forever. Any new feature uses other keys.\n\n### Layer 1: Quick Overlays\n\nSingle-key toggles for visual augmentation. These overlay information on the main sequence view.\n\n```\nG - GC Skew curve (replication origin)\nX - Complexity sparkline (HGT regions)\nB - Bendability track (packaging signals)\nP - Promoter/RBS annotations\nR - Repeat/palindrome markers\n```\n\n**Design Principle**: One key = one overlay. Toggle on/off. Max 3 active overlays.\n\n**Precomputation**: All overlay data computed on phage selection, not on key press. This makes overlays feel instant.\n\n### Layer 2: Analysis Menu\n\nPress `A` to open categorized analysis menu:\n\n```\n╭─────────── Analysis Menu ───────────╮\n│                                      │\n│  WHOLE GENOME                        │\n│  [1] GC Skew Analysis                │\n│  [2] Chaos Game Representation       │\n│  [3] Hilbert Curve Atlas             │\n│  [4] Self-Homology Dot Plot          │\n│  [5] Tetranucleotide PCA             │\n│                                      │\n│  EVOLUTION                           │\n│  [6] dN/dS Selection Pressure        │\n│  [7] Recombination Hotspots          │\n│  [8] Protein Domain Chord Plot       │\n│                                      │\n│  FUNCTION                            │\n│  [9] Codon Adaptation Dashboard      │\n│  [a] Host Range Predictor            │\n│  [b] Arms Race Scanner               │\n│  ...                                 │\n│                                      │\n│  [/] Search   [ESC] Cancel           │\n╰──────────────────────────────────────╯\n```\n\n**Design Principle**: Organized by category, numbered shortcuts, fuzzy search.\n\n### Layer 3: Simulation Hub\n\nPress `Shift+S` to open interactive simulation selector:\n\n```\n╭────────── Simulation Hub ───────────╮\n│                                      │\n│  INTERACTIVE SIMULATIONS             │\n│                                      │\n│  [1] Lysogeny Decision Circuit       │\n│      ODE model of lysis/lysogeny     │\n│      switch with MOI and UV params   │\n│                                      │\n│  [2] Ribosome Traffic Jam            │\n│      Translation particle simulation │\n│      showing codon effects           │\n│                                      │\n│  [3] Plaque Growth Automata          │\n│      2D cellular automaton of        │\n│      plaque formation                │\n│                                      │\n│  [4] Temporal Evolution Replay       │\n│      Animated phylogenetic time-     │\n│      lapse with mutation events      │\n│                                      │\n│  [5] Packaging Motor Pressure        │\n│      60 atm inside the capsid!       │\n│                                      │\n│  [ESC] Cancel                        │\n╰──────────────────────────────────────╯\n```\n\n**Design Principle**: Full-screen takeover, common controls (Space=pause, R=reset, arrows=speed).\n\n### Layer 4: Command Palette\n\nPress `:` or `Ctrl+P` for fuzzy search of ALL features:\n\n```\n╭────────────────────────────────────────────────────────────────────╮\n│ :gc skew                                                     [ESC] │\n├────────────────────────────────────────────────────────────────────┤\n│ ▶ GC Skew Replication Origin        [G]       Overlay             │\n│   Chaos Game Representation         [A→2]     Analysis            │\n│   Genomic Signature PCA             [A→5]     Analysis            │\n│   GC Content Display                [built-in]                     │\n╰────────────────────────────────────────────────────────────────────╯\n```\n\n**Design Principle**: Type anything, find everything. Show shortcut paths.\n\n### Keystroke Budget\n\n```\nLAYER 0 (reserved, untouchable):\n  ↑↓←→ PgUp PgDn Home End\n  N C Space F T D M ? S / Q\n\nLAYER 1 (quick overlays):\n  G X B P R  (5 keys)\n\nLAYER 2 (menu trigger):\n  A\n\nLAYER 3 (simulation trigger):\n  Shift+S\n\nLAYER 4 (command palette):\n  : or Ctrl+P\n\nLAYER 2+ FEATURES (accessed via menu):\n  W (comparison - already exists)\n  K (AA key - already exists)\n  \nRESERVED FOR FUTURE:\n  E I O U Y  (vowels for mnemonic features)\n  H J L Z    (vim-like navigation if needed)\n  1-9        (quick phage selection?)\n```\n\n### Risk Mitigation Strategies\n\n**Risk: Feature bloat slows main loop**\n- Mitigation: Lazy-load analysis components (`React.lazy`)\n- Mitigation: Precompute in background on phage selection\n- Mitigation: Cache aggressively in SQLite\n\n**Risk: Users get lost in menus**\n- Mitigation: ESC always returns to main view\n- Mitigation: Breadcrumb trail in status bar\n- Mitigation: \"Back\" action in every modal\n\n**Risk: Small terminal breaks layouts**\n- Mitigation: Detect terminal size, hide overlays if too small\n- Mitigation: Stack overlays vertically if narrow\n- Mitigation: Minimum viable mode = Layer 0 only\n\n**Risk: Keybinding conflicts**\n- Mitigation: Layer 0 = unmodified lowercase (sacred)\n- Mitigation: Layer 1 = specific lowercase (G, X, B, P, R)\n- Mitigation: Layer 2/3 = Shift+letter or menu selection\n- Mitigation: Layer 4 = `:` prefix (command mode)\n\n### Accessibility Metrics\n\n```\nTotal keystrokes to any feature: 1-3\nVisible complexity for new users: 12 controls\nAvailable power for experts: 31+ features\n```\n\n### Implementation Checklist\n\n- [ ] Document Layer 0 keys in help overlay\n- [ ] Implement overlay manager (max 3 active)\n- [ ] Create ModalMenu component for Layer 2/3\n- [ ] Build CommandRegistry singleton\n- [ ] Implement fuzzy search for palette\n- [ ] Add breadcrumb to status bar\n- [ ] Precompute overlay data on phage selection\n- [ ] Test on 80x24 minimum terminal\n\n### This Epic Blocks\n\nAll UI-related features depend on this philosophy being established and documented.","status":"closed","priority":0,"issue_type":"epic","created_at":"2025-12-06T23:56:39.998888-05:00","updated_at":"2025-12-07T00:00:03.714089-05:00","closed_at":"2025-12-07T00:00:03.714089-05:00"}
{"id":"phage_explorer-fno","title":"Layer 2: Chaos Game Representation (CGR) Fractal Fingerprints","description":"Transform DNA sequences into 2D fractal fingerprints using Chaos Game Representation (CGR). An Iterated Function System maps nucleotides to unit square corners, creating unique visual signatures that encode complete k-mer frequency spectra. Features Braille-character TUI rendering (8x resolution), interactive zoom into k-mer space, side-by-side comparison, and reveals CpG suppression, codon bias, and horizontal gene transfer signatures. Novelty: 9/10, Pedagogical: 9/10, Cool Factor: 10/10.","notes":"## CHAOS GAME REPRESENTATION (CGR) FRACTAL FINGERPRINTS\n\n**Comprehensive Feature Specification from Roadmap**\n\n### Concept\nThe Chaos Game Representation transforms a linear DNA sequence into a 2D fractal image encoding the complete k-mer frequency spectrum in a single visual fingerprint. Based on H. Joel Jeffrey's 1990 algorithm using an Iterated Function System (IFS):\n\n**Algorithm**: Assign nucleotides to unit square corners (A=top-left, T=top-right, G=bottom-right, C=bottom-left). Start at center. For each nucleotide, move halfway toward its corner and place a point. After k steps, point location uniquely encodes the last k nucleotides.\n\n**Biological Insights Revealed**:\n- CpG suppression (void in CG corner region - methylation signature)\n- Codon bias (highly expressed genes cluster in preferred codon regions)\n- Repetitive elements (unusually bright spots = high local k-mer frequency)\n- Horizontal gene transfer (texture discontinuities = mosaic ancestry)\n- Strand asymmetry (leading vs lagging strand preferences)\n\n### Mathematical Foundations\n\n**CGR Iteration Map**:\nGiven corners: A=(0,0), T=(1,0), C=(0,1), G=(1,1)\nStarting: P0 = (0.5, 0.5)\nFor each nucleotide ni: Pi = (Pi-1 + corner(ni)) / 2\n\n**K-mer to Coordinate Mapping (Bijective)**:\nx = sum(i=1 to k) xi / 2^i   (xi = corner_x(si))\ny = sum(i=1 to k) yi / 2^i   (yi = corner_y(si))\nEvery point in [0,1]^2 corresponds to a unique infinite k-mer.\n\n**Frequency CGR (FCGR)**:\nDiscretize unit square into 2^k x 2^k grid. Each cell counts k-mer occurrences:\n- k=3: 8x8 = 64 cells (trinucleotides)\n- k=4: 16x16 = 256 cells (tetranucleotides)\n\n**Fractal Dimension**: D2 = lim(e-\u003e0) log(C(e)) / log(e)\n- Random: D2 ~ 2 (fills plane)\n- Repetitive: D2 \u003c 2 (attractors)\n\n**Comparison Metrics**: Euclidean, Pearson correlation, KL divergence, Cosine similarity\n\n### Implementation\n\n**Core Interfaces**: CGRConfig (resolution, normalize, logScale, smoothing), CGRResult (grid: Float32Array, resolution, maxCount, totalPoints, emptyFraction, entropy)\n\n**computeCGR()**: O(n) iteration, corner lookup, grid increment, entropy calculation\n\n**compareCGR()**: Euclidean distance, Pearson correlation, cosine similarity\n\n**Braille TUI Rendering**: Unicode Braille (0x2800 base) for 8x resolution boost. Heat map coloring.\n\n**Interactive**: Zoom k-mer space, Pan, K-mer lookup, Side-by-side comparison\n\n### Assessment\n- Novelty: 9/10 - CGR + TUI + Braille + interactive zoom unprecedented\n- Pedagogical: 9/10 - IFS, bijective mappings, information theory, chaos\n- Cool Factor: 10/10 - Beautiful fractals from DNA\n\n### Files\n- packages/tui/src/components/CGRView.tsx\n- packages/core/src/analysis/cgr.ts\n- packages/core/src/analysis/cgr-compare.ts","status":"open","priority":1,"issue_type":"feature","created_at":"2025-12-06T23:14:47.023731-05:00","updated_at":"2025-12-07T00:03:27.025404-05:00","dependencies":[{"issue_id":"phage_explorer-fno","depends_on_id":"phage_explorer-54g","type":"blocks","created_at":"2025-12-06T23:14:47.025541-05:00","created_by":"daemon"}]}
{"id":"phage_explorer-ji2","title":"Advanced: Epistasis \u0026 Fitness Landscape Explorer","description":"## Epistasis \u0026 Fitness Landscape Explorer (In Silico DMS)\n\n### Concept\n\nEstimate how combinations of mutations interact (epistasis) on capsid/tail/polymerase to reveal robust vs fragile regions.\n\nSingle mutations have individual effects, but **pairs of mutations can interact**:\n- **Positive epistasis**: Combined effect \u003e sum of individuals (synergy)\n- **Negative epistasis**: Combined effect \u003c sum of individuals (antagonism)\n- **Sign epistasis**: One mutation beneficial alone, deleterious with partner\n\nThis feature performs **in silico deep mutational scanning (DMS)** using protein language models and coupling models to predict:\n- Which positions are mutationally robust vs fragile\n- Where compensatory mutations can rescue deleterious ones\n- Escape routes from immune pressure\n- Designable regions for engineering\n\n### Mathematical Foundations\n\n**Single-mutant fitness from protein LMs:**\n```\nESM-2 and similar models assign log-probabilities to each position:\n\nFor position i mutated from wildtype w to mutant m:\n  ΔΔG_single(i, w→m) ≈ -kT × (log P(m|context) - log P(w|context))\n\nNegative ΔΔG = stabilizing mutation\nPositive ΔΔG = destabilizing mutation\n\nSum over all 20 AAs at each position → single mutant landscape.\n```\n\n**Pairwise epistasis from Potts models:**\n```\nEVcouplings and related methods fit Potts models:\n\nP(sequence) ∝ exp(Σᵢ hᵢ(sᵢ) + Σᵢ\u003cⱼ Jᵢⱼ(sᵢ, sⱼ))\n\nWhere:\n  hᵢ(sᵢ) = single-site field (how preferred is AA sᵢ at position i)\n  Jᵢⱼ(sᵢ, sⱼ) = pairwise coupling (epistatic interaction)\n\nStrong |Jᵢⱼ| = positions i and j are evolutionarily coupled\n  → mutations at i and j are not independent\n  → epistasis is likely\n```\n\n**Epistasis calculation:**\n```\nFor double mutant (i: w₁→m₁, j: w₂→m₂):\n\nExpected additive effect:\n  ΔΔG_add = ΔΔG(i, w₁→m₁) + ΔΔG(j, w₂→m₂)\n\nActual effect (from Potts):\n  ΔΔG_double = ΔΔG_add + ε(i,j)\n\nWhere ε(i,j) = epistatic term:\n  ε \u003e 0: negative epistasis (worse than expected)\n  ε \u003c 0: positive epistasis (better than expected)\n\nSign epistasis: sign(ΔΔG_single) ≠ sign(ΔΔG_double contribution)\n```\n\n**Fitness landscape topology:**\n```\nLocal landscape curvature:\n  Convex (bowl): Easy to optimize, robust\n  Concave (ridge): Fragile, narrow peak\n  Rugged: Many local optima, hard to escape\n\nQuantify via:\n  - Roughness: Correlation between fitness and neighbor fitness\n  - Navigability: Fraction of single-mutant paths to global optimum\n  - Epistasis fraction: Fraction of pairs with |ε| \u003e threshold\n```\n\n### Implementation Approach\n\n**ESM-2 single mutant predictions:**\n```typescript\ninterface SingleMutantEffect {\n  position: number;\n  wildtype: string;\n  mutant: string;\n  ddG: number;  // Predicted ΔΔG\n  confidence: number;\n  category: 'stabilizing' | 'neutral' | 'destabilizing' | 'lethal';\n}\n\nasync function predictSingleMutants(\n  proteinSequence: string,\n  esmEmbeddings: Float32Array\n): Promise\u003cSingleMutantEffect[]\u003e {\n  // For each position, score all 19 alternative AAs\n  // Use masked language model scoring\n  // Return sorted by effect\n}\n```\n\n**Potts model for epistasis (Rust/WASM):**\n```rust\npub struct PottsModel {\n    h: Array2\u003cf64\u003e,  // [L, 21] single-site fields\n    J: Array4\u003cf64\u003e,  // [L, L, 21, 21] pairwise couplings\n}\n\nimpl PottsModel {\n    pub fn fit_from_msa(msa: \u0026MSA, regularization: f64) -\u003e Self {\n        // Pseudolikelihood maximization\n        // Returns fitted h and J parameters\n    }\n    \n    pub fn compute_epistasis(\u0026self, pos1: usize, aa1: u8, pos2: usize, aa2: u8) -\u003e f64 {\n        // Return epistatic term ε(i,j)\n    }\n    \n    pub fn epistasis_matrix(\u0026self) -\u003e Array2\u003cf64\u003e {\n        // Return matrix of average |ε| for all position pairs\n    }\n}\n```\n\n**Fitness landscape visualization:**\n```typescript\ninterface FitnessLandscape {\n  protein: string;\n  positions: number[];\n  singleMutants: SingleMutantEffect[];\n  epistasisMatrix: Float32Array;  // L×L matrix\n  robustRegions: { start: number; end: number; score: number }[];\n  fragileRegions: { start: number; end: number; score: number }[];\n  escapeRoutes: { path: string[]; totalFitness: number }[];\n}\n\nfunction identifyRobustFragile(\n  landscape: FitnessLandscape\n): { robust: Region[]; fragile: Region[] } {\n  // Robust: Low average epistasis, many neutral mutations\n  // Fragile: High epistasis, few tolerated mutations\n}\n```\n\n### TUI Visualization\n\n```\nEpistasis \u0026 Fitness Landscape: T4 gp23 (Major Capsid Protein)\n═══════════════════════════════════════════════════════════════════════════════\n\nSINGLE MUTANT HEATMAP (ΔΔG by position and amino acid):\n\nAA        Position along gp23\n │    1    50   100   150   200   250   300   350   400   450   500\nA├────░░░░▒▒▒▒░░░░░░░░████░░░░░░░░░░░░░░▒▒▒▒░░░░░░░░░░░░░░░░████───\nC├────▓▓▓▓████▓▓▓▓████████░░░░████████████████░░░░████░░░░████████───\nD├────░░░░░░░░░░░░░░░░████░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░───\n...\nW├────████████████████████████████████████████████████████████████───\nY├────▓▓▓▓▓▓▓▓████████████▓▓▓▓████████████████████████████████████───\n └────────────────────────────────────────────────────────────────────\n\nLegend: ░ neutral  ▒ mild  ▓ moderate  █ severe/lethal\n\nMutationally ROBUST regions (tolerant): positions 45-62, 180-210\nMutationally FRAGILE regions (intolerant): positions 95-120 (core fold)\n\n───────────────────────────────────────────────────────────────────────────────\n\nEPISTASIS MATRIX (pairwise interaction strength):\n\nPosition\n  │    1    50   100   150   200   250   300   350   400   450   500\n 1├    ·    ░    ░    ░    ░    ░    ▒    ░    ░    ░    ░\n50├    ░    ·    ░    ▓    ░    ░    ░    ░    ░    ░    ░\n100├   ░    ░    ·    ░    ████ ░    ░    ░    ░    ░    ░\n150├   ░    ▓    ░    ·    ░    ░    ░    ░    ░    ░    ░\n200├   ░    ░    ████ ░    ·    ▓    ░    ░    ░    ░    ░\n...\n500├   ░    ░    ░    ░    ░    ░    ░    ░    ░    ░    ·\n\nStrong coupling: pos 100 ↔ 200 (likely structural contact)\nStrong coupling: pos 50 ↔ 150 (co-evolving residues)\n\n───────────────────────────────────────────────────────────────────────────────\n\nSELECTED PAIR: Position 100 (Val) ↔ Position 200 (Ile)\n\n              Single mutants           Double mutant\n             ─────────────────        ─────────────────\nV100A:       ΔΔG = +2.1 (moderate)\n                                  →   V100A + I200V: ΔΔG = +0.8\nI200V:       ΔΔG = +1.5 (mild)                      (POSITIVE EPISTASIS!)\n                                      \nEpistasis ε = -2.8 (rescuing)         Compensatory pair identified!\n\nInterpretation:\n  These positions are in contact in the folded structure.\n  V100A alone disrupts packing, but I200V compensates.\n  \nImplications:\n  ⚠ Antibody targeting V100 may be escaped via V100A + I200V\n  ✓ V100 is fragile in isolation but escapable with compensation\n\n───────────────────────────────────────────────────────────────────────────────\n\nESCAPE ROUTES (3 mutations to escape immune pressure at epitope 95-105):\n\nPath                          Total fitness cost    Viability\nV100A → I200V → E98D          +1.2 kcal/mol        ████████░░ Likely viable\nV100L → I200L → E98A          +2.8 kcal/mol        ████░░░░░░ Marginal\nV100G → I200V → E98G          +4.5 kcal/mol        ░░░░░░░░░░ Unlikely\n\n[P] Switch protein   [R] Show robust regions   [E] Explore escape   [ESC] Exit\n```\n\n### Why This Is Good\n\n1. **Anticipate evolution**: Predict escape mutations before they arise.\n2. **Engineering guidance**: Which positions are safe to modify?\n3. **Structure without structure**: Epistasis reveals contacts from sequence alone.\n4. **Vaccine/antibody design**: Target regions with no escape routes.\n5. **Epistasis maps in terminal for phage are rare**: Usually academic papers only.\n\n### Innovation Assessment\n\n**Novelty: HIGH** - DMS heatmaps exist (lab experiments, EVcouplings), but interactive TUI exploration with escape route prediction is novel. In silico DMS for phage proteins specifically is underexplored.\n\n**Pedagogical Value: 9/10** - Teaches fitness landscapes, epistasis, protein evolution, mutational robustness.\n\n**Wow Factor: 9/10** - 2D heatmaps with position×position epistasis; selecting a cell shows the specific double-mutant effect; escape route pathfinding.\n\n### Dependencies\n- ESM-2 embeddings (precomputed, ~1-5GB)\n- Potts model fitting (Rust/WASM, ~10MB)\n- MSA for each protein (can generate from database)\n- phage_explorer-54g (Menu Infrastructure)","status":"open","priority":3,"issue_type":"feature","created_at":"2025-12-06T23:54:34.192624-05:00","updated_at":"2025-12-06T23:54:34.192624-05:00","dependencies":[{"issue_id":"phage_explorer-ji2","depends_on_id":"phage_explorer-54g","type":"blocks","created_at":"2025-12-06T23:56:51.449633-05:00","created_by":"daemon"}]}
{"id":"phage_explorer-kul","title":"Layer 2: Sequence Logo Generator","description":"Create information-theoretic sequence logos from multiple sequence alignments. Compute Shannon entropy per position, letter heights proportional to frequency × information content. Standard for visualizing conserved motifs (promoters, RBS, binding sites). Supports both DNA (max 2 bits) and protein (max 4.3 bits) alphabets. ASCII art stacked letters with bit scale. Novelty: 6/10, Pedagogical: 9/10, Cool Factor: 7/10.","notes":"## SEQUENCE LOGO GENERATOR\n\n**Comprehensive Feature Specification from Roadmap**\n\n### Concept\nCreate information-theoretic sequence logos from multiple sequence alignments. The standard visualization for conserved motifs in promoters, ribosome binding sites, transcription factor binding sites.\n\n**What sequence logos show**:\n- Height of stack at each position = total information content (bits)\n- Height of each letter within stack = that base's contribution\n- Highly conserved positions have tall stacks (near 2 bits for DNA)\n- Variable positions have short stacks (near 0 bits)\n\n### Mathematical Foundations\n\n**Information Content**:\nFor DNA: max_bits = 2 (log2(4) nucleotides)\nFor protein: max_bits = 4.3 (log2(20) amino acids)\n\n**Shannon Entropy at position p**:\nH(p) = -sum(f(b,p) * log2(f(b,p))) for all bases b\n\nwhere f(b,p) = frequency of base b at position p\n\n**Information Content**:\nR(p) = max_bits - H(p) - e(n)\n\nwhere e(n) = small sample correction = (s-1) / (2 * ln(2) * n)\ns = number of symbols, n = number of sequences\n\n**Letter Heights**:\nheight(b,p) = f(b,p) * R(p)\n\nLetters stacked smallest at bottom, largest on top.\n\n### Implementation\n\n**Core Interface**:\n```typescript\ninterface LogoColumn {\n  position: number;\n  totalBits: number;  // Information content\n  letters: { char: string; height: number }[];  // Sorted by height\n}\n\nfunction generateLogo(alignment: string[], type: 'dna' | 'protein'): LogoColumn[]\n```\n\n**Key Functions**:\n- Count frequencies at each position\n- Calculate Shannon entropy\n- Compute information content per position\n- Sort letters by height for stacking\n- Render as ASCII art with scaled heights\n\n### TUI Visualization\n\n```\nPromoter -10 box consensus logo:\n\nBits\n 2.0 |     T\n     |     T A A A\n 1.5 |     T A A A T\n     |   T T A A A T\n 1.0 |   T T A A A T\n     |   T T A A A T\n 0.5 | T T T A A A T A\n     | T T T A A A T A T\n 0.0 +-+-+-+-+-+-+-+-+-+-\n       1 2 3 4 5 6 7 8 9\n\nConsensus: TATAAT (Pribnow box)\nInformation content: 8.2 bits (highly conserved)\n```\n\n### Assessment\n- Novelty: 6/10 - Standard bioinformatics tool, but TUI rendering is useful\n- Pedagogical: 9/10 - Teaches information theory, conservation, motif structure\n- Cool Factor: 7/10 - Seeing letter stacks is intuitive and satisfying\n\n### Files\n- packages/tui/src/components/LogoView.tsx\n- packages/core/src/analysis/sequence-logo.ts\n- packages/core/src/analysis/alignment-utils.ts","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-06T23:12:45.391548-05:00","updated_at":"2025-12-07T00:06:19.92041-05:00","dependencies":[{"issue_id":"phage_explorer-kul","depends_on_id":"phage_explorer-54g","type":"blocks","created_at":"2025-12-06T23:12:45.393178-05:00","created_by":"daemon"}]}
{"id":"phage_explorer-ltm","title":"Advanced: Host-Phage Protein Interaction \u0026 Docking Map","description":"Predict host targets of phage effectors (anti-defense, RBPs) via ESM/ProtT5 embedding similarity, PFAM domain filtering, and optional coarse docking. Bipartite graph UI with confidence edges, residue tooltips. Generates mechanistic host-range and anti-defense hypotheses beyond BLAST. Novelty: High, Pedagogical: High (embeddings, docking, domain-function).","notes":"## HOST-PHAGE PROTEIN INTERACTION \u0026 EFFECTOR DOCKING MAP\n\n### Concept\nPredict host targets of phage effectors (anti-defense, RBPs) by fusing embeddings, domains, and optional docking.\n\n### How to Build\n- **Embeddings**: Precompute ESM/ProtT5 vectors offline; store in SQLite as float32 blobs\n- **Search**: Cosine ANN (Rust+WASM or TS) to shortlist host targets\n- **Domains**: PFAM/HHPred annotations to filter plausible interactions\n- **Docking (optional)**: Coarse rigid docking via lightdock/pydock3 offline; store top ranks\n- **Scoring**: Fuse embedding sim + docking + domain compatibility → confidence\n- **UI**: Bipartite graph; edges encode confidence; tooltips show docking score, residues; filters for receptor/defense/metabolism\n\n### Why It's Good\nGenerates mechanistic host-range and anti-defense hypotheses beyond BLAST.\n\n### Implementation Stack\nOffline Python for embeddings/docking; SQLite cache; Rust+WASM or TS ANN; TS/Ink UI.\n\n### TUI Visualization\nInteractive \"wiring\" board; hover to see residues/contact score; hit 'f' to filter by functional class.\n\n### Files\n- packages/core/src/analysis/protein-interaction.ts\n- packages/tui/src/components/InteractionGraphView.tsx","status":"open","priority":3,"issue_type":"feature","created_at":"2025-12-06T23:50:09.694441-05:00","updated_at":"2025-12-07T00:15:36.945002-05:00","dependencies":[{"issue_id":"phage_explorer-ltm","depends_on_id":"phage_explorer-54g","type":"blocks","created_at":"2025-12-06T23:56:51.05269-05:00","created_by":"daemon"}]}
{"id":"phage_explorer-ofm","title":"Foundation: Help System Redesign (Contextual Layered Help)","description":"## Help System Redesign (Contextual Layered Help)\n\nReplace single help overlay with contextual, layered help system.\n\n### New Help Layout\n- Two-column layout: Navigation/View Controls\n- Overlays section (G/X/B/P/R toggles)\n- Search section\n- Advanced section (A menu, Shift+S hub, : palette)\n\n### Progressive Disclosure\n- Press ? once: Essential controls only\n- Press ? twice: Detailed docs with feature explanations\n- Context-sensitive: Show relevant shortcuts based on current view\n\n### Features\n- Each overlay explained\n- Each analysis tool described\n- Keyboard shortcut cheatsheet\n- ESC always exits\n\nDepends on: UI Design System (phage_explorer-dx3)","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-06T23:35:35.397685-05:00","updated_at":"2025-12-07T00:04:19.099563-05:00","closed_at":"2025-12-07T00:04:19.099563-05:00","dependencies":[{"issue_id":"phage_explorer-ofm","depends_on_id":"phage_explorer-2g5","type":"blocks","created_at":"2025-12-06T23:35:35.399184-05:00","created_by":"daemon"},{"issue_id":"phage_explorer-ofm","depends_on_id":"phage_explorer-dx3","type":"blocks","created_at":"2025-12-06T23:39:00.284879-05:00","created_by":"daemon"}]}
{"id":"phage_explorer-ojb","title":"Foundation: Simulation Framework","description":"Create common infrastructure for 5 interactive simulations: Lysogeny Circuit, Ribosome Traffic, Plaque Automata, Evolution Replay, Packaging Motor. Implement Simulation interface with init/step/render lifecycle. Common controls: Space=pause, R=reset, arrows=speed.","status":"in_progress","priority":0,"issue_type":"epic","created_at":"2025-12-06T23:08:59.749642-05:00","updated_at":"2025-12-07T00:06:07.859283-05:00"}
{"id":"phage_explorer-oqh","title":"Layer 2: Selection Pressure Chromosome Painter (dN/dS Landscape)","description":"Layer 2 Analysis: Compute dN/dS (omega) across genes, paint chromosome by selection pressure. Blue=purifying (essential), Red=positive (arms race), Gray=neutral. Nei-Gojobori method with JC correction. Requires comparison phage. Pedagogical: 10/10.","status":"open","priority":1,"issue_type":"feature","created_at":"2025-12-06T23:11:46.057601-05:00","updated_at":"2025-12-06T23:22:16.15258-05:00","dependencies":[{"issue_id":"phage_explorer-oqh","depends_on_id":"phage_explorer-54g","type":"blocks","created_at":"2025-12-06T23:11:46.060136-05:00","created_by":"daemon"},{"issue_id":"phage_explorer-oqh","depends_on_id":"phage_explorer-2g5","type":"blocks","created_at":"2025-12-06T23:39:30.270014-05:00","created_by":"daemon"}]}
{"id":"phage_explorer-owy","title":"Layer 2: Host Range Predictor (CRISPR Spacer Matching)","description":"## Host Range Predictor via CRISPR/Spacer Matching (Immunity Landscape)\n\n### Concept\nCRISPR spacers are MOLECULAR FOSSILS OF PAST INFECTIONS — bacterial memory of phage encounters. The global collection represents a map of phage-host evolutionary warfare. This feature:\n1. **Predict immune hosts**: Which bacteria have defenses against this phage?\n2. **Find immunity hotspots**: Which phage regions are most commonly targeted?\n3. **Identify vulnerable regions**: Sequences rarely targeted = conserved essentials\n4. **Assess therapeutic compatibility**: Will the target bacterium resist this phage?\n\n### Mathematical Foundations\n\n**Approximate string matching:**\nCRISPR systems tolerate mismatches (typically ≤3) and still provide immunity.\nMatch if: edit_distance(spacer, target_region) ≤ 3\nEfficiency: k-mer seeding (k=10-12) + verification with full edit distance\n\n**Statistical significance (E-value):**\np_match = (1/4)^k × genome_length\nE-value = database_size × query_length × p_match\nSignificant match if E-value \u003c 0.01\n\n**PAM verification:**\n- Cas9 (Type II): NGG at 3' end of protospacer\n- Cas12 (Type V): TTTV at 5' end\n- Type I systems: Various PAMs (AAG, etc.)\nPAM score = 1.0 (perfect), 0.5 (1 mismatch), 0 (no PAM)\n\n**Phylogenetic breadth score:**\nBreadth = number of distinct host genera with immunity\nHigh breadth = phage encountered across diverse bacteria\nLow breadth = host-specific targeting\n\n**Immunity half-life modeling:**\nSpacer age ∝ divergence from phage sequence\nEstimate acquisition time from mutation rate\n\n### Implementation (Rust/WASM)\n\nSpacerIndex struct with:\n- kmer_to_spacers: HashMap\u003cu64, Vec\u003cSpacerId\u003e\u003e\n- add_spacer(spacer: SpacerEntry)\n- find_matches(query, max_mismatches) → Vec\u003cSpacerMatch\u003e\n\nedit_distance_bounded(a, b, max) → Option\u003cusize\u003e\n  Early termination when min_val \u003e max for efficiency\n\nTypeScript orchestration:\n- Load pre-built spacer index\n- Scan genome in 40bp windows (typical spacer length)\n- Verify PAM for each match\n- Compute E-value significance\n- Build immunity landscape\n\n### Data Sources (~50MB compressed)\n- CRISPRdb: ~200,000 spacers from complete genomes\n- CRISPRCasdb: Larger, includes metagenomic data\n- IMG/VR: Viral metagenome spacers\n\n### TUI Visualization\n\n**Immunity Landscape Navigator:**\n- Density track along genome (▓ hotspot, ░ sparse)\n- Vulnerable regions highlighted (rarely targeted = conserved)\n- Host distribution bar chart by genus\n- Phylogenetic breadth score\n\n**Therapeutic Compatibility Matrix:**\n┌─────────────────┬────────────┬─────────────────────┬──────────┐\n│ Strain          │ Resistance │ CRISPR Evidence     │ Predict  │\n├─────────────────┼────────────┼─────────────────────┼──────────┤\n│ E. coli MG1655  │ LOW        │ 1 spacer (3 mm)     │ ✓ Use    │\n│ E. coli O157:H7 │ HIGH       │ 4 spacers (0-1 mm)  │ ✗ Avoid  │\n└─────────────────┴────────────┴─────────────────────┴──────────┘\n\n**Detailed spacer alignment view:**\n- Show phage vs spacer alignment with mismatches marked\n- PAM verification status\n- Host taxonomy, Cas type, E-value\n\n### Pedagogical Value: 10/10\nTeaches CRISPR-Cas biology (adaptive immunity), approximate string matching (edit distance, k-mer indexing), host-parasite coevolution (molecular arms race), therapeutic considerations (why some phages fail), database design (efficient indexing).\n\n### No other tool integrates CRISPR databases with a genome browser!","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-06T23:12:45.734-05:00","updated_at":"2025-12-06T23:32:23.591741-05:00","dependencies":[{"issue_id":"phage_explorer-owy","depends_on_id":"phage_explorer-54g","type":"blocks","created_at":"2025-12-06T23:12:45.735205-05:00","created_by":"daemon"},{"issue_id":"phage_explorer-owy","depends_on_id":"phage_explorer-2g5","type":"blocks","created_at":"2025-12-06T23:39:32.636107-05:00","created_by":"daemon"}]}
{"id":"phage_explorer-qlu","title":"Layer 1: DNA Bendability/Curvature Overlay [B key]","description":"Calculate and visualize intrinsic DNA curvature and flexibility based on dinucleotide wedge model parameters (roll, tilt, twist). Reveals packaging signals, A-tract bends, and protein binding sites. Features curvature sparklines, flexibility gradients, A-tract detection, and 2D helix trajectory projection. Connects sequence to physical shape - essential for understanding capsid packaging. Novelty: 8/10, Pedagogical: 9/10, Cool Factor: 8/10.","notes":"## INTRINSIC DNA CURVATURE \u0026 STIFFNESS MAP\n\n**Comprehensive Feature Specification from Roadmap**\n\n### Concept\nDNA is not a rigid rod - its shape depends on sequence. This feature calculates and visualizes intrinsic curvature and flexibility based on dinucleotide structural parameters, revealing packaging signals, promoter bends, and protein binding sites.\n\n**Why DNA Shape Matters**:\n- Phage capsids pack 40-170kb into ~50nm diameter - requires bending\n- Terminases recognize curved DNA at packaging sites\n- Promoters often contain bent DNA for polymerase recognition\n- A-tracts (AAAA...) cause strong bends toward minor groove\n\n**The Physics**: Each dinucleotide step has characteristic roll, tilt, and twist angles. Cumulative effect over ~10bp creates measurable bends.\n\n### Mathematical Foundations\n\n**Dinucleotide Wedge Model**:\nEach step has angles: roll (rho), tilt (tau), twist (omega)\n\nWEDGE_ANGLES (degrees):\nAA/TT: roll=0, tilt=-0.3, twist=35.6 (stiff, bends)\nAT: roll=0, tilt=0, twist=30.0\nTA: roll=3.2, tilt=0, twist=36.0 (flexible)\nGG/CC: roll=0, tilt=0.6, twist=33.0\nGC: roll=0, tilt=0, twist=35.0\nCG: roll=5.0, tilt=0, twist=29.0 (very flexible)\n\n**Curvature Calculation**:\nC = (1/L) * |sum(angles over window)|\n\nFor 10.5bp window (one helical turn):\nCurvature in degrees/turn\n\n**Flexibility Score**:\nBased on base-step variability. TA, CA/TG steps most flexible. AA/TT stiff.\n\nFLEXIBILITY values: TA=1.9, CA/TG=1.7, CG=1.5, GG/CC=0.8, AA/TT=0.6\n\n**Persistence Length**: ~150bp for B-DNA, shorter for flexible sequences\n\n**A-tract Phasing**: A-tracts spaced ~10.5bp apart create cumulative bend (phased arrays)\n\n### Implementation\n\n**analyzeCurvature(sequence, windowSize=21)**: Returns array of {position, curvature, flexibility, aTracts}\n\n**Helix Trajectory**: Track 3D path of helix axis using rotation matrices. Project to 2D for ASCII visualization.\n\n**projectTrajectory()**: Map 3D points to 2D grid, render with dots\n\n### TUI Visualization\n\nCurvature sparkline: degrees/turn with A-tract markers\nFlexibility bar: stiff to flexible gradient\nA-tract positions: marked on genome track\nHelix trajectory: 2D projection showing bends at A-tracts\n\nStatistics: Peak curvature position, mean flexibility, A-tract count and phasing\n\n### Assessment\n- Novelty: 8/10 - DNA curvature prediction rare in TUI, connected to packaging biology\n- Pedagogical: 9/10 - Polymer physics, DNA structure, sequence-structure relationships\n- Cool Factor: 8/10 - Seeing DNA as curved molecule is eye-opening\n\n### Files\n- packages/tui/src/components/CurvatureView.tsx\n- packages/core/src/analysis/dna-curvature.ts\n- packages/core/src/data/dinucleotide-params.ts","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-06T23:10:40.824309-05:00","updated_at":"2025-12-07T00:14:22.436515-05:00","closed_at":"2025-12-07T00:14:22.436515-05:00","dependencies":[{"issue_id":"phage_explorer-qlu","depends_on_id":"phage_explorer-2g5","type":"blocks","created_at":"2025-12-06T23:10:40.825179-05:00","created_by":"daemon"}]}
{"id":"phage_explorer-sek","title":"Overlay caching, 3D pause keybinding, overlay legends","description":"Implement caching for overlays (complexity and others), add non-conflicting 3D pause key, add sparkline legends.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T00:11:53.52113-05:00","updated_at":"2025-12-07T00:14:21.56502-05:00","closed_at":"2025-12-07T00:14:21.56502-05:00"}
{"id":"phage_explorer-t9j","title":"Advanced: Structural Epitope Clash Map","description":"## Structural Epitope Clash Map (Tail Fiber Host Range Analyzer)\n\n### Concept\nThe tail fiber is the phage's MOLECULAR KEY — its receptor-binding domain (RBD) determines host specificity. This feature combines:\n1. **Structural analysis**: ΔΔG alanine scans and electrostatics on predicted structures\n2. **Modular domain detection**: Identify N-anchor, shaft, and hypervariable RBD regions\n3. **Entropy-based variability mapping**: Find conserved vs rapidly-evolving positions\n4. **Host range prediction**: Infer likely hosts from RBD sequence features\n\n### Mathematical Foundations\n\n**Shannon entropy for per-position variability:**\nH(i) = -Σ p(a) × log₂(p(a)) for each alignment position\n- H(i) = 0: Perfectly conserved (functional constraint)\n- H(i) = 4.3: Maximum entropy (20 AA, no constraint)\nEntropy profile reveals low entropy in anchor/shaft (structural), high in RBD (host-range variability)\n\n**Domain boundary detection:**\nTail fibers have conserved modular structure: [N-anchor] — [Shaft repeats] — [RBD]\nDetect via:\n- Entropy gradient peaks (sudden variability change)\n- Hydropathy profile transitions\n- Secondary structure predictions (α-helix shaft → β-sheet RBD)\n- Recombination breakpoint detection\n\n**Structural stability (ΔΔG):**\nΔΔG = ΔG(wild-type) - ΔG(alanine mutant)\n- High ΔΔG = structurally important (core)\n- Low ΔΔG = surface-exposed, tolerant to mutation\n- Negative ΔΔG = destabilizing, likely under selection\n\n**Host range prediction features:**\nFor ML model: k-mer frequencies (k=3,4,5), AA composition, predicted secondary structure, isoelectric point, molecular weight, specific motifs (carbohydrate-binding, Ig-like folds)\n\n### Implementation\n- entropyProfile(alignment) → Float64Array of per-position entropy\n- detectDomainBoundaries(entropy, hydropathy, secondaryStructure) → DomainBoundary[]\n- predictHostRange(rbdSequence, knownRBDs) → HostPrediction[] with confidence\n- analyzeStructuralEpitopes(pdbId, sequence) → StructuralRisk[] (ΔΔG, surface area, charge)\n\n### TUI Visualization (Multi-Layer)\n- Domain structure bar: N-anchor | Shaft | RBD with conservation coloring\n- Entropy profile sparkline (low in anchor, high in RBD)\n- Structural risk profile (ΔΔG instability)\n- Host range prediction table with confidence bars\n- Chimera suggestion: \"Swap RBD (aa 850-1132) with P22 gpJ → Predicted new host: Salmonella\"\n- 3D ASCII model with epitope highlighting (charge/risk mode toggle)\n\n### Pedagogical Value: 9/10\nTeaches receptor-ligand biology, protein modularity, information theory (Shannon entropy), structural biology (surface exposure, electrostatics), evolution of specificity (arms race in molecular detail).\n\n### External Dependencies\n- AlphaFold DB or ESMFold for structure prediction\n- FoldX (or ML surrogate) for ΔΔG calculations\n- APBS for electrostatics\n\n### Priority: P4 (highest complexity)","status":"open","priority":4,"issue_type":"feature","created_at":"2025-12-06T23:21:06.440127-05:00","updated_at":"2025-12-06T23:31:50.332681-05:00","dependencies":[{"issue_id":"phage_explorer-t9j","depends_on_id":"phage_explorer-54g","type":"blocks","created_at":"2025-12-06T23:21:06.441895-05:00","created_by":"daemon"}]}
{"id":"phage_explorer-u8f","title":"Advanced: Capsid Packaging \u0026 Ejection Energetics Simulator","description":"Quantify physics of packing dsDNA into capsid and ejection: force-extension, internal pressure (up to ~60 atm), salt/GC effects. Worm-Like Chain elasticity + Debye-Hückel electrostatics + bending energy. Compare headful vs cos vs phi29 portal strategies. Interactive sliders for ionic strength, temperature; fill fraction animation. Bridges genome composition to biophysical feasibility. Novelty: High, Pedagogical: High.","notes":"## CAPSID PACKAGING \u0026 EJECTION ENERGETICS SIMULATOR\n\n### Concept\nQuantify the physics of packing dsDNA into a confined capsid and its subsequent ejection. Model force-extension, internal pressure (up to ~60 atm), salt/GC effects, and differences among headful vs cos vs phi29 portal strategies.\n\n### How to Build\n- **Physics core (Rust+WASM)**: Worm-Like Chain elasticity + Debye-Hückel electrostatics + bending energy; ndarray + nalgebra; compile to WASM\n- **Precompute per phage**: Given genome length, GC%, capsid radius, portal type → force/energy curves; cache in SQLite\n- **Motor benchmarks**: Table of ATP/bp and stall forces for T4, lambda, phi29 for comparison overlays\n- **Controls**: Sliders for ionic strength (Na+/Mg2+), temperature; toggle headful/cos; \"fill fraction\" scrubber animates packing/ejection\n\n### Why It's Good\nLinks genome composition to biophysical feasibility and ejection vigor—useful for stability, storage, and therapeutic formulation.\n\n### Implementation Stack\nRust+WASM physics; TS/Bun UI; SQLite cache; minimal deps beyond ndarray/nalgebra/statrs.\n\n### TUI Visualization\nASCII force-distance plot; live pressure gauge flashing at high fill; \"unspooling\" animation on ejection; overlay motor benchmarks as dashed curves.\n\n### Files\n- packages/core/src/physics/packaging-energetics.ts\n- packages/tui/src/components/PackagingSimView.tsx","status":"open","priority":3,"issue_type":"feature","created_at":"2025-12-06T23:48:08.831742-05:00","updated_at":"2025-12-07T00:14:52.815899-05:00","dependencies":[{"issue_id":"phage_explorer-u8f","depends_on_id":"phage_explorer-ojb","type":"blocks","created_at":"2025-12-06T23:56:50.829947-05:00","created_by":"daemon"}]}
{"id":"phage_explorer-ug4","title":"Layer 2: Auxiliary Metabolic Gene (AMG) Pathway Mapper","description":"Detect AMGs via HMMER vs curated profiles, map to KEGG reactions, estimate pathway flux gains via Delta-FBA in target hosts. Template models for common hosts, Δflux per pathway. Turns annotations into quantitative metabolic impact; surfaces hijacking strategies. Novelty: Medium-high, Pedagogical: High (stoichiometry, metabolic control).","notes":"## AUXILIARY METABOLIC GENE (AMG) FLUX POTENTIAL ANALYZER\n\n### Concept\nDetect AMGs, map to KEGG reactions, and estimate pathway flux gains in target hosts.\n\n### How to Build\n- **Detection**: HMMER vs curated AMG profiles (offline); KO mapping cached\n- **Flux**: Delta-FBA: small LP solved in TS (simple solver) or Rust+WASM (good_lp) for speed\n- **Hosts**: Template models for common hosts; map AMGs to reactions; recompute objective (ATP/dNTP)\n- **Outputs**: Δflux per pathway; confidence from KO scores; highlight biggest boosts\n\n### Why It's Good\nTurns annotations into quantitative metabolic impact; surfaces hijacking strategies.\n\n### Implementation Stack\nOffline HMMER; Rust+WASM or TS LP; SQLite cache.\n\n### TUI Visualization\nPathway mini-map with AMG nodes glowing; \"flux gain\" badges; host-switch toggle to watch deltas change.\n\n### Files\n- packages/core/src/analysis/amg-flux.ts\n- packages/tui/src/components/AMGPathwayView.tsx","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-06T23:12:45.993704-05:00","updated_at":"2025-12-07T00:15:41.792646-05:00","dependencies":[{"issue_id":"phage_explorer-ug4","depends_on_id":"phage_explorer-54g","type":"blocks","created_at":"2025-12-06T23:12:45.995081-05:00","created_by":"daemon"}]}
{"id":"phage_explorer-ujh","title":"Advanced: Protein Domain Chord Plot","description":"## Protein Domain Chord Plot (Advanced Feature)\n\n### Concept\n\nPhage proteomes are **modular mosaics** — built from shuffled and recombined functional domains. The same DNA-binding domain might appear in the repressor of one phage and the anti-repressor of another. The same tail fiber receptor-binding domain might be swapped between distant phages to change host range.\n\nA **chord diagram** visualizes these domain-sharing relationships as arcs connecting phages. Each arc represents a shared domain, with thickness proportional to copy number or sequence identity. The result reveals:\n- **Core domains**: Present in all phages (structural essentials)\n- **Accessory domains**: Patchy distribution (niche adaptation)\n- **Domain promiscuity**: Domains appearing in unexpected combinations\n- **Convergent evolution**: Same domain, independent acquisitions\n\n### Mathematical Foundations\n\n**Domain Detection via HMM profiles:**\n```\nHMMER3 hmmscan workflow:\n  1. Query each protein against Pfam-A HMM database\n  2. For each domain hit:\n     - E-value \u003c 1e-5 (significant)\n     - Coverage \u003e 60% of HMM model\n     - No envelope overlap with higher-scoring hits\nOutput: domain annotations with Pfam accession, name, positions, bit score\n```\n\n**Domain occurrence matrix:**\n```\nLet D = {d₁, d₂, ..., dₘ} = all detected domains\nLet P = {p₁, p₂, ..., pₙ} = all phages\n\nOccurrence matrix O[m × n]:\n  O[i,j] = count of domain dᵢ in phage pⱼ\n\nPresence/absence matrix B[m × n]:\n  B[i,j] = 1 if O[i,j] \u003e 0, else 0\n```\n\n**Domain co-occurrence (for clustering):**\n```\nJaccard similarity between domains:\n  J(dᵢ, dⱼ) = |phages with both| / |phages with either|\n\nDomains with high Jaccard often function together.\nCluster with MCL (Markov Cluster Algorithm) to find domain modules.\n```\n\n**Chord diagram layout:**\n```\nPhages arranged on circle (0 to 2π): θᵢ = 2π × i / n\nFor each shared domain connecting phages pᵢ and pⱼ:\n  Draw Bezier curve from θᵢ to θⱼ\n  Control points at circle center (creates arc shape)\nArc thickness ∝ number of shared copies or sequence identity\n```\n\n### Implementation Approach\n\n**Domain hit storage:**\n```typescript\ninterface DomainHit {\n  pfamId: string;\n  pfamName: string;\n  clanId?: string;\n  proteinId: string;\n  phageId: number;\n  start: number;\n  end: number;\n  score: number;\n  eValue: number;\n  description: string;\n}\n```\n\n**Domain sharing computation:**\n```typescript\ninterface DomainSharing {\n  domain: string;\n  phageA: number;\n  phageB: number;\n  copiesA: number;\n  copiesB: number;\n  averageIdentity: number;\n}\n\n// Find all pairwise sharings across phages\n// Group by domain family for filtering\n```\n\n**MCL clustering for domain modules:**\n```typescript\ninterface DomainCluster {\n  id: number;\n  domains: string[];\n  name: string;  // Inferred function\n  phageCount: number;\n}\n\n// Build adjacency from co-occurrence Jaccard\n// MCL iterations: expand (matrix multiply) + inflate (element-wise power)\n// Extract clusters from converged matrix\n```\n\n**ASCII Braille chord renderer:**\n```typescript\n// Braille characters give 2x4 dots per cell = high resolution curves\n// placeBraillePoint() sets individual dots in character grid\n// Bezier curves drawn point-by-point through center\n// Result: smooth arcs connecting phages on outer ring\n```\n\n### TUI Visualization\n\n```\nProtein Domain Chord Plot: Lambda + T4 + T7 + P22 + Phi29\n═══════════════════════════════════════════════════════════════════════════════\n\n              Lambda\n                ╱╲\n              ╱    ╲\n           ⡠⠊      ⠑⡄\n         ⡰⠁          ⠑⡄\n       ⡠⠃              ⠘⡄\n      ⡜                  ⠘⡄           Selected: HTH_3 (Helix-turn-helix)\n    ⡰⠁                    ⠑⡄           Found in: Lambda (cI), P22 (c2)\n   ⡜                        ⠘⡄          Function: DNA-binding repressor\n  ⡜                          ⠘⡄\n ⡔    T4                 P22   ⠢⡀\n⡎      ⠑⢄                ⡠⠊      ⠱⡀\n⡇        ⠑⢄            ⡠⠊        ⠱⡀\n⡇          ⠑⢄        ⡠⠊          ⢱\n⡇            ⠑⢄    ⡠⠊            ⢱\n⡇              ⠑⢄⡠⠊              ⢱\n⠘⡄              ⡜               ⡰⠁\n ⠘⡄            ⡜               ⡰⠁\n  ⠘⡄          ⡜               ⡰⠁\n   ⠑⡄        ⡜              ⡰⠁\n    ⠑⡄      ⡜   Phi29     ⡠⠊\n     ⠑⡄    ⡜            ⡠⠊\n       ⠑⡄⡰⠁          ⡠⠊\n         ⠱⡀        ⡠⠊\n           T7───────⠁\n\n───────────────────────────────────────────────────────────────────────────────\n\nDomain Summary:\n┌─────────────┬──────────────────────────────┬────────┬─────────────────┐\n│ Domain      │ Phages                       │ Copies │ Function        │\n├─────────────┼──────────────────────────────┼────────┼─────────────────┤\n│ Phage_cap_E │ Lambda, T4, T7, P22, Phi29   │   8    │ Capsid protein  │\n│ HTH_3       │ Lambda, P22                  │   2    │ DNA binding     │\n│ Phage_tail  │ Lambda, T4, P22              │  12    │ Tail structure  │\n│ DNA_pol_B   │ T4, T7, Phi29                │   3    │ DNA replication │\n│ Peptidase_M │ Lambda, T4, T7, P22          │   4    │ Lysis           │\n└─────────────┴──────────────────────────────┴────────┴─────────────────┘\n\nLegend: ━ Core (all phages)  ─ Common (3-4)  ╌ Rare (2)\n\n[Tab] Cycle domains  [Enter] Show alignment  [F] Filter by clan  [ESC] Exit\n```\n\n### Why This Is Good\n\n1. **Domain-level evolution**: Genes evolve, but domains are truly modular units. Domain sharing reveals deeper relationships.\n2. **Function transfer mechanism**: Which domains spread through phage populations.\n3. **Protein engineering hints**: Domain X appears with domain Y = may function together.\n4. **Beautiful data reduction**: Thousands of genes → dozens of domains → one elegant visualization.\n5. **Novel TUI visualization**: Chord diagrams in terminals are rare; Braille curves push ASCII art boundaries.\n\n### Innovation Assessment\n\n**Novelty: HIGH** - Chord diagrams exist (Circos), but no TUI implementation. ASCII/Braille curve rendering is novel. Interactive domain filtering is new.\n\n**Pedagogical Value: 9/10** - Teaches protein domains, HMM profiles, modular evolution, network visualization.\n\n**Wow Factor: 9/10** - Smooth Braille curves connecting distant phages through shared domains is visually stunning.\n\n### Data Requirements\n- HMMER + Pfam-A database for domain detection (offline preprocessing)\n- Pre-computed domain_hits table in SQLite\n- ~50MB additional data for Pfam profiles","status":"open","priority":3,"issue_type":"feature","created_at":"2025-12-06T23:20:17.342284-05:00","updated_at":"2025-12-06T23:43:59.044724-05:00","dependencies":[{"issue_id":"phage_explorer-ujh","depends_on_id":"phage_explorer-54g","type":"blocks","created_at":"2025-12-06T23:20:17.344679-05:00","created_by":"daemon"}]}
{"id":"phage_explorer-w71","title":"Layer 2: Prophage Excision Precision Mapper","description":"Layer 2 Analysis: Predict exact attL/attR sites for temperate phages. Find integrase, search for imperfect direct repeats at boundaries. Model excision product. Essential for temperate phage biology.","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-06T23:13:38.973351-05:00","updated_at":"2025-12-06T23:22:42.804123-05:00","dependencies":[{"issue_id":"phage_explorer-w71","depends_on_id":"phage_explorer-54g","type":"blocks","created_at":"2025-12-06T23:13:38.974873-05:00","created_by":"daemon"}]}
{"id":"phage_explorer-wae","title":"Advanced: Pan-Phage Latent Space Atlas","description":"## Pan-Phage Latent Space Atlas (Protein Embedding Galaxy)\n\n### Concept\nLearn a continuous manifold of phage genomes and proteins to expose evolutionary neighborhoods, functional clusters, and modular swaps. Traditional function prediction via BLAST fails for ~50% of phage genes (\"viral dark matter\"). Modern protein language models (ESM-2, ProtTrans) learn evolutionary and functional information, producing embeddings where proximity = functional similarity even without sequence homology.\n\n### Dual-Level Embeddings\n1. **Genome-level**: VAE with dual encoder — (a) k-mer CNN/Transformer over DNA; (b) gene-order graph via Graph Attention Networks (PyTorch + torch-geometric)\n2. **Protein-level**: ESM-2 embeddings (1280-dim vectors) capturing evolutionary context, secondary structure, functional domains\n\n### Implementation Options\n- **Full ML**: Train VAE in PyTorch, export embeddings, cache in SQLite\n- **Lightweight**: Pre-compute ESM-2 embeddings during database build, store in protein_embeddings table\n- **Fallback offline**: k-mer frequencies + physico-chemical descriptors (no ML)\n\n### Database Schema\nCREATE TABLE protein_embeddings (\n  protein_id INTEGER PRIMARY KEY,\n  phage_id INTEGER NOT NULL,\n  gene_name TEXT,\n  embedding BLOB,     -- Float32Array (1280 dims for ESM-2)\n  umap_x REAL,        -- Pre-computed 2D projection\n  umap_y REAL,\n  cluster_id INTEGER, -- HDBSCAN cluster assignment\n  novelty_score REAL  -- Distance to nearest known-function cluster\n);\n\n### Key Algorithms\n- UMAP: nNeighbors=15, minDist=0.1, metric='cosine'\n- HDBSCAN: density-based clustering, no need to specify k\n- Hungarian algorithm for optimal protein matching between phages\n- Outliers (label=-1) are potentially novel functions\n\n### TUI Visualization: \"Galaxy\"\n- 2D scatter plot with phage proteins as points\n- Symbols by source phage (∴ Lambda, ○ T4, ⊙ T7)\n- Clusters labeled by function (Tail fibers, Lysins, Capsid, etc.)\n- Isolated points = UNKNOWN (novel?)\n- Cluster detail view: Show all proteins in cluster with confidence scores\n\n### Pedagogical Value: 9/10\nTeaches manifold learning, protein language models, HDBSCAN vs k-means, functional inference via \"guilt by association\", viral dark matter challenge.\n\n### Dependencies\n- phage_explorer-2g5 (Overlay System)\n- phage_explorer-54g (Menu Infrastructure)\n\n### Data Requirements\nPrecomputed embeddings (~1-5GB), WASM-compiled inference (~10MB optional)","status":"open","priority":3,"issue_type":"epic","created_at":"2025-12-06T23:19:10.733099-05:00","updated_at":"2025-12-06T23:30:58.074292-05:00","dependencies":[{"issue_id":"phage_explorer-wae","depends_on_id":"phage_explorer-2g5","type":"blocks","created_at":"2025-12-06T23:19:10.736323-05:00","created_by":"daemon"},{"issue_id":"phage_explorer-wae","depends_on_id":"phage_explorer-54g","type":"blocks","created_at":"2025-12-06T23:19:10.738549-05:00","created_by":"daemon"}]}
{"id":"phage_explorer-wtf","title":"Layer 1: Sequence Complexity Overlay [X key]","description":"Layer 1 overlay (X key): Display Kolmogorov complexity (compression ratio) sparkline. Highlights HGT regions (high complexity, unusual composition), repetitive elements (low complexity). Uses pako gzip. Pedagogical: information theory, entropy. Priority: P1.","status":"in_progress","priority":1,"issue_type":"feature","created_at":"2025-12-06T23:10:40.550053-05:00","updated_at":"2025-12-07T00:06:01.2465-05:00","dependencies":[{"issue_id":"phage_explorer-wtf","depends_on_id":"phage_explorer-2g5","type":"blocks","created_at":"2025-12-06T23:10:40.5507-05:00","created_by":"daemon"}]}
