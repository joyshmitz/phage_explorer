/**
 * Mobile Overrides - Clean Mobile-First Design
 *
 * Design Principles:
 * 1. Mobile-first: Base styles for phones, enhance for larger screens
 * 2. Single-column layout: Everything stacks vertically on mobile
 * 3. Bottom navigation: Controls at thumb-reach
 * 4. 48px+ touch targets: WCAG 2.5.5 compliant
 * 5. Full-screen views: Maximize content, minimize chrome
 * 6. Safe area support: Handle notches and home indicators
 *
 * Breakpoints:
 * - 480px: Small phones
 * - 640px: Large phones / small tablets (PHONE breakpoint)
 * - 900px: Tablets (NARROW breakpoint)
 */

/* =============================================================================
   CSS CUSTOM PROPERTIES FOR MOBILE
   ============================================================================= */

:root {
  --mobile-header-height: 56px;
  --mobile-tab-bar-height: 56px;
  /* Used by popovers/toasts to stay above the mobile control deck (safe-area handled separately). */
  --control-deck-reserved-height: var(--mobile-tab-bar-height);
  --mobile-safe-bottom: env(safe-area-inset-bottom, 0px);
  --mobile-safe-top: env(safe-area-inset-top, 0px);
  --mobile-safe-left: env(safe-area-inset-left, 0px);
  --mobile-safe-right: env(safe-area-inset-right, 0px);
}

/* =============================================================================
   TABLET BREAKPOINT (max-width: 900px)
   ============================================================================= */

@media (max-width: 900px) {
  /* Typography token overrides live in typography.css for a single source of truth. */

  /* App Shell - Single column */
  .app-shell {
    /* IMPORTANT: account for iOS safe-area inset so the header isn't clipped by the
       fixed grid track + `overflow: hidden` on `.app-shell`. */
    grid-template-rows: calc(var(--mobile-header-height) + var(--mobile-safe-top)) minmax(0, 1fr) auto;
  }

  /* Header - Compact */
  .app-header {
    padding: 0 var(--space-3);
    min-height: var(--mobile-header-height);
    gap: var(--space-2);
  }

  .header-left {
    gap: var(--space-2);
  }

  .header-right {
    gap: var(--space-2);
  }

  /* Hide subtitle on tablets */
  .app-subtitle {
    display: none;
  }

  /* Main content - Less padding */
  .app-body {
    padding: var(--space-3);
    gap: var(--space-3);
  }

  /* Two column layout becomes single column */
  .panel.two-column {
    display: flex;
    flex-direction: column;
    gap: var(--space-3);
  }

  /* Detail viewers stack */
  .detail-viewers {
    grid-template-columns: 1fr;
    gap: var(--space-3);
  }

  /* 3D container - Responsive height */
  .three-container {
    min-height: 280px;
    height: clamp(280px, 50vh, 400px);
  }

  /* Hide desktop-only elements */
  .analysis-sidebar,
  .action-toolbar {
    display: none;
  }

  /* Show FAB on tablets */
  .fab {
    display: flex;
  }
}

/* =============================================================================
   PHONE BREAKPOINT (max-width: 640px)
   ============================================================================= */

@media (max-width: 640px) {
  /* App shell - Account for bottom tab bar */
  .app-body {
    padding: var(--space-2);
    padding-bottom: calc(var(--mobile-tab-bar-height) + var(--mobile-safe-bottom) + var(--space-4));
  }

  /* Header - Ultra compact */
  .app-header {
    padding: 0 var(--space-2);
    padding-top: var(--mobile-safe-top);
    min-height: calc(var(--mobile-header-height) + var(--mobile-safe-top));
  }

  .app-title {
    font-size: var(--text-base);
    max-width: 160px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }

  /* Hide badges in header on phones */
  .app-header .badge {
    display: none;
  }

  /* Ultra-compact header buttons on phones */
  .header-right {
    gap: var(--space-1);
  }

  .header-right .btn {
    padding: var(--space-1) var(--space-2);
    min-height: 36px;
    min-width: 36px;
  }

  /* Footer - Hidden on phones (replaced by tab bar) */
  .app-footer {
    display: none;
  }

  /* Phage list - Takes full viewport when open */
  .column--list.mobile-drawer {
    position: fixed;
    inset: 0;
    top: calc(var(--mobile-header-height) + var(--mobile-safe-top));
    z-index: var(--z-overlay);
    background: var(--color-background);
    padding: var(--space-3);
    padding-bottom: calc(var(--mobile-tab-bar-height) + var(--mobile-safe-bottom) + var(--space-3));
    display: flex;
    flex-direction: column;
    animation: slideInFromLeft 0.2s var(--ease-out);
  }

  @keyframes slideInFromLeft {
    from {
      transform: translateX(-100%);
      opacity: 0;
    }
    to {
      transform: translateX(0);
      opacity: 1;
    }
  }

  /* List in drawer - Full height */
  .column--list.mobile-drawer .list {
    flex: 1;
    max-height: none;
    min-height: 0;
    overflow-y: auto;
  }

  /* When drawer is NOT open, show constrained list */
  .column--list:not(.mobile-drawer) .list {
    max-height: 35vh;
    min-height: 150px;
  }

  /* Panels - Full width, minimal padding */
  .panel {
    padding: var(--space-2);
    border-radius: var(--radius-lg);
  }

  .panel-header {
    padding: var(--space-2) var(--space-3);
  }

  .panel-body {
    padding: var(--space-2);
  }

  /* Detail card - Compact */
  .detail-card {
    padding: var(--space-2);
  }

  /* 3D container - Phone optimized */
  .three-container {
    min-height: 240px;
    height: clamp(240px, 45vh, 320px);
    border-radius: var(--radius-lg);
  }

  /* Sequence view - Compact controls */
  .sequence-view {
    min-height: 200px;
  }

  /* Sequence view header controls - ensure minimum touch targets on phones */
  .sequence-view .btn.compact {
    min-height: 44px;
    min-width: 44px;
  }

  .sequence-view__zoom-label {
    height: 44px;
  }

  /* View mode toggle - Compact but usable on mobile */
  .view-mode-toggle {
    padding: 3px;
    gap: 2px;
    width: fit-content;
    /* Let it size to its content; the surrounding controls row is horizontally scrollable. */
    max-width: none;
    flex: 0 0 auto;
  }

  .view-mode-segment {
    padding: 6px 10px;
    min-height: 44px;
    min-width: 44px;
    font-size: 13px;
    font-weight: 600;
    /* Prevent text wrapping */
    white-space: nowrap;
  }

  .view-mode-icon {
    display: none;
  }

  /* Sliding indicator adjustment for mobile padding */
  .view-mode-indicator {
    top: 3px;
    left: 3px;
    height: calc(100% - 6px);
  }

  /* Quick stats - styles moved to desktop-ui.css for consistency */
  /* Only add mobile-specific containment here */
  .quick-stats--mobile {
    margin: 0;
    max-width: 100vw;
    overscroll-behavior-x: contain;
  }

  /* Buttons - Touch friendly */
  .btn {
    min-height: 44px;
    padding: var(--space-2) var(--space-3);
    font-size: var(--text-sm);
  }

  .btn-sm {
    min-height: 36px;
    padding: var(--space-1) var(--space-2);
    font-size: var(--text-xs);
  }

  /* List items - Larger touch targets */
  .list-item {
    min-height: 56px;
    padding: var(--space-3);
  }

  /* Badges - Compact */
  .badge {
    font-size: 10px;
    padding: 2px 6px;
  }

  /* Hide FAB on phones - Control deck replaces it */
  .fab {
    display: none;
  }

  /* Empty state - Compact */
  .empty-state {
    padding: var(--space-6) var(--space-4);
  }

  .empty-state__icon {
    font-size: 2.5rem;
  }

  .empty-state__title {
    font-size: var(--text-lg);
  }

  .empty-state__description {
    font-size: var(--text-sm);
  }

  /* Glossary shell - Full screen on phones */
  .glossary-shell {
    top: 0;
    bottom: 0;
    width: 100%;
    max-width: 100%;
    border-left: none;
    border-radius: 0;
  }
}

/* =============================================================================
   SMALL PHONE BREAKPOINT (max-width: 480px)
   ============================================================================= */

@media (max-width: 480px) {
  .app-title {
    font-size: var(--text-sm);
    max-width: 120px;
  }

  .header-right .btn {
    padding: var(--space-1);
    min-width: 36px;
    font-size: 10px;
  }

  /* Even more compact spacing */
  .app-body {
    padding: var(--space-1);
  }

  .panel {
    border-radius: var(--radius-md);
  }

  /* Stack buttons vertically if needed */
  .header-right {
    gap: var(--space-1);
  }
}

/* =============================================================================
   TOUCH DEVICE OPTIMIZATIONS
   ============================================================================= */

@media (hover: none) and (pointer: coarse) {
  /* Ensure all interactive elements have 44px+ touch targets */
  button,
  .btn,
  [role="button"],
  [role="tab"],
  [role="option"],
  a[href]:not(.badge) {
    min-height: 44px;
    min-width: 44px;
  }

  /* List items - Larger touch targets */
  .list-item,
  [role="option"] {
    min-height: 52px;
    padding: var(--space-3);
  }

  /* Inputs - Comfortable touch height */
  input[type="text"],
  input[type="search"],
  input[type="number"],
  select,
  textarea {
    min-height: 48px;
    padding: var(--space-3);
    font-size: 16px; /* Prevents iOS zoom on focus */
  }

  /* Checkboxes and radios */
  input[type="checkbox"],
  input[type="radio"] {
    width: 24px;
    height: 24px;
  }

  /* Labels wrapping inputs provide touch target */
  label:has(input[type="checkbox"]),
  label:has(input[type="radio"]) {
    min-height: 44px;
    display: flex;
    align-items: center;
    gap: var(--space-2);
    padding: var(--space-2) 0;
  }

  /* View mode segments - styled in 640px media query above */

  /* Remove hover effects - they don't make sense on touch */
  .btn:hover,
  .list-item:hover {
    transform: none;
  }

  /* Active states instead of hover */
  .btn:active {
    transform: scale(0.97);
    background: var(--color-background-active);
  }

  .list-item:active {
    background: var(--color-background-active);
  }

  /* Scrollbars - Hidden on touch devices */
  ::-webkit-scrollbar {
    display: none;
  }

  * {
    scrollbar-width: none;
  }
}

/* =============================================================================
   LANDSCAPE PHONE OPTIMIZATIONS
   ============================================================================= */

@media (orientation: landscape) and (max-height: 500px) {
  /* Compact header in landscape */
  .app-header {
    min-height: 44px;
    padding: 0 var(--space-2);
  }

  .app-title {
    font-size: var(--text-sm);
  }

  /* Hide non-essential header elements */
  .app-subtitle,
  .header-left .badge,
  .beginner-indicator {
    display: none;
  }

  /* App body - Side-by-side layout possible */
  .app-body {
    padding: var(--space-2);
    padding-bottom: calc(48px + var(--mobile-safe-bottom) + var(--space-2));
  }

  /* Two column can show side by side in landscape */
  .panel.two-column {
    display: grid;
    grid-template-columns: minmax(200px, 1fr) 2fr;
    gap: var(--space-2);
    height: calc(var(--app-height, 100vh) - 44px - 48px - var(--mobile-safe-bottom) - var(--space-4));
  }

  .column--list {
    max-height: none;
    overflow-y: auto;
  }

  .column--detail {
    overflow-y: auto;
  }

  /* Detail viewers stack vertically but compact */
  .detail-viewers {
    gap: var(--space-2);
  }

  /* 3D container - Shorter in landscape */
  .three-container {
    min-height: 150px;
    height: clamp(150px, 35vh, 200px);
  }

  /* Control deck - Tabs only in landscape */
  .control-deck .deck-content {
    display: none;
  }

  .control-deck.is-expanded .deck-content {
    display: flex;
    position: absolute;
    bottom: 100%;
    left: 0;
    right: 0;
    background: var(--color-background-elevated);
    border-top: 1px solid var(--color-border);
    border-bottom: none;
  }
}

/* =============================================================================
   UTILITY CLASSES FOR MOBILE
   ============================================================================= */

/* Show only on mobile */
.mobile-only {
  display: none;
}

@media (max-width: 640px) {
  .mobile-only {
    display: flex;
  }
}

/* Hide on mobile */
.desktop-only {
  display: flex;
}

@media (max-width: 640px) {
  .desktop-only {
    display: none;
  }
}

/* =============================================================================
   DATA FRESHNESS INDICATOR POSITIONING
   ============================================================================= */

.data-freshness-indicator {
  position: fixed;
  bottom: var(--space-3);
  right: var(--space-3);
  z-index: var(--z-fixed);
}

@media (max-width: 900px) {
  .data-freshness-indicator {
    bottom: calc(var(--space-3) + 60px);
    right: var(--space-3);
  }
}

@media (max-width: 640px) {
  .data-freshness-indicator {
    bottom: calc(var(--mobile-tab-bar-height) + var(--mobile-safe-bottom) + var(--space-3));
    right: var(--space-2);
  }
}

/* =============================================================================
   REDUCED MOTION - Disable animations for accessibility
   ============================================================================= */
@media (prefers-reduced-motion: reduce) {
  .column--list.mobile-drawer {
    animation: none;
  }
}
